<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>EdgeWize - Poker Player Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@700&family=Allura&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            /* Prevent pull-to-refresh on mobile */
            overscroll-behavior-y: contain;
            /* Better text rendering */
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            /* Smooth scrolling */
            scroll-behavior: smooth;
        }

        :root {
            --bg-dark: #0a0e27;
            --bg-mid: #1a1f3a;
            --purple-primary: #a855f7;
            --purple-light: #c084fc;
            --cyan-accent: #22d3ee;
            --orange-accent: #FF9A00;
            --white: #ffffff;
            
            /* Legacy mappings */
            --dark-bg: #0a0e27;
            --blue-accent: #22d3ee;
            --orange-primary: #a855f7;
            --card-white: #ffffff;
            --shadow-dark: rgba(10, 14, 39, 0.8);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: 
                /* Dark overlay */
                linear-gradient(135deg, rgba(10, 14, 39, 0.7) 0%, rgba(26, 31, 58, 0.8) 50%, rgba(15, 22, 41, 0.7) 100%),
                /* Brushed metal texture */
                repeating-linear-gradient(
                    0deg,
                    #c0c5ce 0px,
                    #d4d8de 1px,
                    #e8eaed 2px,
                    #d4d8de 3px,
                    #c0c5ce 4px,
                    #a8adb5 5px,
                    #c0c5ce 6px
                ),
                /* Base metallic color */
                linear-gradient(90deg, #b8bdc5 0%, #c8cdd5 50%, #b8bdc5 100%);
            color: var(--white);
            min-height: 100vh;
            padding: 1rem;
            position: relative;
            /* Touch optimizations */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
            -webkit-overflow-scrolling: touch;
        }

        /* Add metallic shine effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(
                    115deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.05) 30%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.05) 70%,
                    transparent 100%
                );
            pointer-events: none;
            z-index: 0;
        }

        /* Remove old effect */
        body::after {
            display: none;
        }

        /* SPLASH SCREEN */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(135deg, rgba(10, 14, 39, 0.7) 0%, rgba(26, 31, 58, 0.8) 50%, rgba(15, 22, 41, 0.7) 100%),
                repeating-linear-gradient(
                    0deg,
                    #c0c5ce 0px,
                    #d4d8de 1px,
                    #e8eaed 2px,
                    #d4d8de 3px,
                    #c0c5ce 4px,
                    #a8adb5 5px,
                    #c0c5ce 6px
                ),
                linear-gradient(90deg, #b8bdc5 0%, #c8cdd5 50%, #b8bdc5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            cursor: pointer;
        }

        .splash-metal-sheet {
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 3px solid #a8acb4;
            border-radius: 16px;
            padding: 4rem 6rem;
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.5),
                0 6px 16px rgba(0, 0, 0, 0.4),
                inset 0 3px 6px rgba(255, 255, 255, 0.5),
                inset 0 -3px 6px rgba(0, 0, 0, 0.3),
                inset 3px 0 6px rgba(255, 255, 255, 0.3),
                inset -3px 0 6px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .splash-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 4.5rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 2px 0 rgba(255, 255, 255, 0.4),
                0 -2px 2px rgba(0, 0, 0, 0.7),
                2px 0 0 rgba(255, 255, 255, 0.2),
                -2px 0 2px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
            letter-spacing: 2px;
            margin-bottom: 2rem;
        }

        .splash-card-suits {
            display: flex;
            gap: 2rem;
            justify-content: center;
            align-items: center;
            margin-bottom: 6rem;
        }

        .splash-card-suits .suit {
            width: 48px;
            height: 48px;
            filter: drop-shadow(0 2px 2px rgba(255, 255, 255, 0.4))
                    drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.6));
        }

        .splash-copyright {
            font-family: Arial, sans-serif;
            font-size: 0.7rem;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
            margin-top: 3rem;
        }

        /* DASHBOARD GRID BUTTONS */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .dashboard-btn {
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 3px solid #a8acb4;
            border-radius: 16px;
            padding: 3rem 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2),
                inset 2px 0 4px rgba(255, 255, 255, 0.3),
                inset -2px 0 4px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            min-height: 200px;
        }

        .dashboard-btn:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.4),
                0 6px 16px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2),
                inset 2px 0 4px rgba(255, 255, 255, 0.3),
                inset -2px 0 4px rgba(0, 0, 0, 0.15);
        }

        .dashboard-btn:active {
            transform: translateY(0px);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.2),
                inset 0 3px 6px rgba(0, 0, 0, 0.3),
                inset 0 -1px 2px rgba(255, 255, 255, 0.3);
        }

        .dashboard-btn svg {
            filter: drop-shadow(0 2px 2px rgba(255, 255, 255, 0.5))
                    drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.4));
            stroke: #9333ea;
            opacity: 0.8;
        }

        .dashboard-btn span {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.4),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
        }

        /* EXIT BUTTON */
        .exit-btn {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            padding: 0;
            border-radius: 10px;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 2px 3px rgba(255, 255, 255, 0.5),
                inset 0 -2px 3px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .exit-btn:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                0 3px 8px rgba(0, 0, 0, 0.3),
                inset 0 2px 3px rgba(255, 255, 255, 0.5),
                inset 0 -2px 3px rgba(0, 0, 0, 0.2);
        }

        .exit-btn:active {
            transform: translateX(-50%) translateY(0px);
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .exit-btn svg {
            filter: drop-shadow(0 1px 1px rgba(255, 255, 255, 0.4))
                    drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.4));
            stroke: #dc2626;
            opacity: 0.8;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: 
                /* Brushed nickel texture */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                /* Base metallic color */
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border-radius: 16px;
            border: 2px solid #a8acb4;
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.5),
                inset 0 3px 0 rgba(255, 255, 255, 0.7),
                inset 0 -3px 0 rgba(0, 0, 0, 0.35),
                inset 3px 0 0 rgba(255, 255, 255, 0.35),
                inset -3px 0 0 rgba(0, 0, 0, 0.25);
            position: relative;
        }

        header::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(135deg, 
                rgba(168, 85, 247, 0.4) 0%, 
                transparent 50%, 
                rgba(34, 211, 238, 0.4) 100%);
            border-radius: 16px;
            z-index: -1;
            opacity: 0.6;
        }

        h1 {
            font-family: 'Allura', cursive;
            font-size: 4rem;
            font-weight: 400;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 2px 0 rgba(255, 255, 255, 0.4),
                0 -2px 2px rgba(0, 0, 0, 0.8),
                2px 0 0 rgba(255, 255, 255, 0.2),
                -2px 0 2px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.5));
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .card-suits {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 0.5rem;
            font-size: 2rem;
            font-style: italic;
            transform: skewX(-12deg);
        }

        .suit {
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
        }

        .suit.spade::before { content: '♠'; }
        .suit.club::before { content: '♣'; }
        .suit.heart::before { content: '♥'; }
        .suit.diamond::before { content: '♦'; }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.875rem 1.75rem;
            background: 
                /* Brushed nickel texture */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                /* Base metallic */
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border: 2px solid #a8acb4;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.875rem;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
            text-align: center;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(0, 0, 0, 0.25);
            color: #2a2e3a;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3),
                0 0 20px rgba(168, 85, 247, 0.3);
        }

        .tab.active {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: var(--white);
            border-color: #8b2fc9;
            box-shadow: 
                0 6px 20px rgba(168, 85, 247, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            background: 
                /* Brushed nickel texture */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                /* Base metallic color */
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            /* Laser-cut edge with beveled metal look */
            border: 2px solid #a8acb4;
            box-shadow: 
                /* Outer shadow - plate sitting on surface */
                0 8px 24px rgba(0, 0, 0, 0.4),
                /* Top bevel highlight */
                inset 0 2px 0 rgba(255, 255, 255, 0.6),
                /* Bottom bevel shadow */
                inset 0 -2px 0 rgba(0, 0, 0, 0.3),
                /* Left bevel highlight */
                inset 2px 0 0 rgba(255, 255, 255, 0.3),
                /* Right bevel shadow */
                inset -2px 0 0 rgba(0, 0, 0, 0.2);
            position: relative;
        }

        /* Add laser-cut edge glow effect */
        .section::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, 
                rgba(168, 85, 247, 0.3) 0%, 
                transparent 30%, 
                transparent 70%, 
                rgba(34, 211, 238, 0.3) 100%);
            border-radius: 12px;
            z-index: -1;
            opacity: 0.5;
        }

        .section-title {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1.35rem;
            font-weight: 900;
            color: transparent;
            background: linear-gradient(135deg, #3a3e46 0%, #2a2e36 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.4),
                0 -1px 1px rgba(0, 0, 0, 0.7),
                1px 0 0 rgba(255, 255, 255, 0.2),
                -1px 0 1px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.4));
            font-variant: small-caps;
            letter-spacing: 1.4px;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-size: 1.0rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
            font-variant: small-caps;
        }

        .form-group input[type="text"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            transition: all 0.3s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--purple-primary);
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 0.875rem 2rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: var(--white);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* METALLIC ICON BUTTONS */
        .btn-metallic {
            width: 56px;
            height: 56px;
            padding: 0;
            margin: 0;
            /* Apple keyboard: very tight radius */
            border-radius: 6px;
            /* Clean matte keycap surface */
            background:
                linear-gradient(
                    180deg,
                    #e4e6ea 0%,
                    #d6d8dc 40%,
                    #cbcdd1 100%
                );
            /* Sharp, precise border */
            border: 1px solid #a0a2a6;
            border-bottom: 2px solid #909296;
            box-shadow:
                /* Key sitting on surface — tight, crisp */
                0 1px 0 rgba(255, 255, 255, 0.6),
                0 2px 1px rgba(0, 0, 0, 0.12),
                0 3px 2px rgba(0, 0, 0, 0.08),
                /* Very subtle inner top highlight */
                inset 0 1px 0 rgba(255, 255, 255, 0.65);
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-metallic:hover {
            transform: translateY(-1px);
            background:
                linear-gradient(
                    180deg,
                    #eaecf0 0%,
                    #dcdee2 40%,
                    #d1d3d7 100%
                );
            box-shadow:
                0 1px 0 rgba(255, 255, 255, 0.6),
                0 3px 2px rgba(0, 0, 0, 0.15),
                0 5px 4px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .btn-metallic:active {
            transform: translateY(1px);
            background:
                linear-gradient(
                    180deg,
                    #c8cacf 0%,
                    #cdcfd3 40%,
                    #d2d4d8 100%
                );
            border-bottom: 1px solid #909296;
            box-shadow:
                0 0 0 rgba(0, 0, 0, 0),
                inset 0 1px 3px rgba(0, 0, 0, 0.15),
                inset 0 0 1px rgba(0, 0, 0, 0.1);
        }

        /* Etched icon style */
        .btn-metallic svg {
            filter: drop-shadow(0 1px 1px rgba(255, 255, 255, 0.5))
                    drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.3));
            opacity: 0.7;
        }

        .btn-metallic.btn-delete svg {
            stroke: #dc2626;
        }

        .btn-metallic.btn-save svg {
            stroke: #9333ea;
        }

        .btn-metallic.btn-new svg {
            stroke: #9333ea;
        }

        .btn-metallic.btn-exit svg {
            stroke: #dc2626;
        }

        .list-container {
            display: grid;
            gap: 1rem;
        }

        .list-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--blue-accent);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .list-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--orange-primary);
            transform: translateX(5px);
        }

        .list-item.selected {
            border-left-color: var(--orange-primary);
            background: rgba(255, 154, 0, 0.1);
        }

        .list-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .list-item-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--orange-primary);
        }

        .list-item-meta {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background: rgba(255, 154, 0, 0.2);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--orange-primary);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        /* MOBILE OPTIMIZATION */
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            /* Body & Container */
            body {
                padding: 0.5rem;
                padding-left: max(0.5rem, env(safe-area-inset-left));
                padding-right: max(0.5rem, env(safe-area-inset-right));
                padding-bottom: max(0.5rem, env(safe-area-inset-bottom));
            }

            .container {
                padding: 0;
            }

            /* Splash Screen - Mobile */
            .splash-metal-sheet {
                padding: 3rem 2rem;
                margin: 1rem;
            }

            .splash-logo {
                font-size: 3rem;
                margin-bottom: 1.5rem;
            }

            .splash-card-suits {
                gap: 1.5rem;
                margin-bottom: 4rem;
            }

            .splash-card-suits .suit {
                width: 36px;
                height: 36px;
            }

            /* Dashboard - Mobile Grid */
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .dashboard-btn {
                min-height: 120px;
                padding: 2rem 1rem;
            }

            .dashboard-btn svg {
                width: 36px;
                height: 36px;
            }

            .dashboard-btn span {
                font-size: 1rem;
            }

            /* Drum Picker - Mobile */
            .combo-lock-frame {
                width: 92%;
            }

            .combo-lock-frame .apple-picker-container {
                height: 220px;
            }

            .apple-picker-item {
                height: 40px;
                font-size: 0.85rem;
            }

            .apple-picker-item.selected {
                font-size: 1rem;
            }
            
            .apple-picker-selection-bar {
                height: 40px;
            }

            /* Form Elements - Mobile */
            .section {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .section-title {
                font-size: 1.25rem;
            }

            .form-subsection-header {
                font-size: 0.95rem;
            }

            /* Sliders - Larger Touch Targets */
            .range-slider::-webkit-slider-thumb {
                width: 28px;
                height: 34px;
            }

            .range-slider::-moz-range-thumb {
                width: 28px;
                height: 34px;
            }

            .slider-value-labels {
                font-size: 0.75rem;
            }

            /* Buttons - Larger Touch Targets */
            .btn-metallic {
                width: 54px;
                height: 54px;
                min-width: 54px;
                min-height: 54px;
            }

            .btn-metallic svg {
                width: 22px;
                height: 22px;
            }

            /* Button Row - Mobile Spacing */
            .form-group:has(.btn-metallic) > div {
                max-width: 100% !important;
                gap: 0.5rem;
            }

            /* Exit Button - Mobile */
            .exit-btn {
                width: 54px;
                height: 54px;
                bottom: 1rem;
            }

            .exit-btn svg {
                width: 22px;
                height: 22px;
            }

            /* Text Areas */
            textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            input[type="text"],
            input[type="number"] {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Form Groups */
            .form-group {
                margin-bottom: 1.5rem;
            }

            .slider-layout {
                gap: 0.6rem;
            }

            .slider-layout label {
                min-width: 100px;
                font-size: 0.82rem;
            }

            .slider-value-labels {
                font-size: 0.7rem;
                padding: 0 4px;
                gap: 2px;
            }

            .slider-value-label {
                text-align: center;
            }

            /* Descriptor Chips - Mobile */
            .desc-selector {
                gap: 0.4rem 0.5rem;
            }

            .desc-chip {
                font-size: 0.72rem;
                padding: 0.3rem 0.1rem;
                letter-spacing: 0.3px;
            }

            .form-group.slider-layout:has(.desc-selector) {
                flex-direction: column;
                gap: 0.3rem;
            }

            .form-group.slider-layout:has(.desc-selector) > label {
                min-width: unset;
                padding-top: 0;
            }

            /* Notecard - Mobile */
            .notecard-section {
                min-height: 80px;
            }

            .notecard-entry {
                font-size: 0.78rem;
            }

            .notecard-inline-input {
                font-size: 16px; /* Prevents iOS zoom */
            }

            .notecard-edit-btn,
            .notecard-add-btn {
                padding: 0.5rem;
            }

            /* Form subsection spacing */
            .form-subsection {
                margin-bottom: 1rem;
                padding: 0.75rem;
            }
        }

        /* Small Phones - Stack sliders vertically */
        @media (max-width: 480px) {
            .form-group.slider-layout {
                flex-direction: column;
                gap: 0.3rem;
            }

            .form-group.slider-layout > label {
                min-width: unset;
                padding-top: 0;
                margin-bottom: 0.15rem;
            }

            .slider-value-labels {
                font-size: 0.72rem;
                padding: 0 2px;
            }
        }

        /* Extra Small Phones */
        @media (max-width: 375px) {
            .splash-logo {
                font-size: 2.5rem;
            }

            .splash-card-suits {
                gap: 1rem;
            }

            .splash-card-suits .suit {
                width: 30px;
                height: 30px;
            }

            .dashboard-btn {
                min-height: 100px;
                padding: 1.5rem 1rem;
            }

            .dashboard-btn svg {
                width: 32px;
                height: 32px;
            }

            .dashboard-btn span {
                font-size: 0.95rem;
            }

            .combo-lock-frame {
                width: 96%;
            }
            .combo-lock-frame .apple-picker-container {
                height: 200px;
            }

            .btn-metallic {
                width: 48px;
                height: 48px;
                min-width: 48px;
                min-height: 48px;
            }

            .slider-layout label {
                min-width: 80px !important;
                font-size: 0.78rem;
            }

            .slider-value-labels {
                font-size: 0.65rem !important;
                padding: 0 2px !important;
            }

            .desc-chip {
                font-size: 0.68rem;
                padding: 0.25rem 0.05rem;
            }

            .desc-selector {
                gap: 0.35rem;
            }
        }

        /* Landscape Phones */
        @media (max-width: 768px) and (orientation: landscape) {
            .splash-metal-sheet {
                padding: 2rem;
            }

            .splash-logo {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }

            .splash-card-suits {
                margin-bottom: 2rem;
            }

            .combo-lock-frame .apple-picker-container {
                height: 180px;
            }

            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Touch Improvements */
        @media (hover: none) and (pointer: coarse) {
            /* Larger tap targets for touch devices */
            .btn,
            .dashboard-btn,
            .btn-metallic,
            .exit-btn,
            .apple-picker-item {
                -webkit-tap-highlight-color: rgba(168, 85, 247, 0.2);
            }

            /* Remove hover states on touch */
            .btn:hover,
            .dashboard-btn:hover,
            .btn-metallic:hover {
                transform: none;
            }

            /* Active states for touch feedback */
            .btn:active,
            .dashboard-btn:active {
                transform: scale(0.98);
            }

            .btn-metallic:active {
                transform: translateY(1px);
            }
        }

        /* Tablet Portrait */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }

            .combo-lock-frame {
                width: 60%;
            }
        }

        .brief-player {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--blue-accent);
        }

        .brief-player-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--orange-primary);
            margin-bottom: 0.5rem;
        }

        .brief-section {
            margin-top: 1rem;
        }

        .brief-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--blue-accent);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .brief-list {
            list-style: none;
            padding-left: 0;
        }

        .brief-list li {
            padding: 0.25rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .brief-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--orange-primary);
        }

        .brief-list.warnings li:before {
            content: "⚠";
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(26, 31, 58, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(168, 85, 247, 0.1);
            transition: all 0.2s ease;
        }

        .checkbox-group:hover {
            background: rgba(26, 31, 58, 0.5);
            border-color: rgba(168, 85, 247, 0.2);
        }

        .toggle-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        /* Toggle switch styling */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 56px;
            height: 28px;
        }

        .toggle-switch input[type="checkbox"] {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            border-radius: 28px;
            transition: all 0.3s ease;
            border: 2px solid #5a5e66;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 1px 2px rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
        }

        /* Y letter on LEFT - revealed when slider moves RIGHT */
        .toggle-slider::before {
            content: 'Y';
            font-size: 0.75rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 0;
        }

        /* N letter on RIGHT - revealed when slider is LEFT */
        .toggle-slider::after {
            content: 'N';
            font-size: 0.75rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
            z-index: 0;
        }

        /* Slider knob */
        .toggle-knob {
            position: absolute;
            height: 20px;
            width: 20px;
            left: 2px;
            top: 2px;
            background: 
                repeating-linear-gradient(
                    90deg,
                    #e0e4ec 0px,
                    #f0f4fc 0.5px,
                    #e0e4ec 1px
                ),
                linear-gradient(180deg, #d8dce4 0%, #c8ccd4 100%);
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            z-index: 1;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            border-color: #a855f7;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.2),
                0 0 12px rgba(168, 85, 247, 0.4);
        }

        /* Brighten Y when checked (slider RIGHT, revealing LEFT) */
        .toggle-switch input:checked + .toggle-slider::before {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Dim N when checked */
        .toggle-switch input:checked + .toggle-slider::after {
            color: rgba(255, 255, 255, 0.2);
        }

        /* Move knob when checked */
        .toggle-switch input:checked + .toggle-slider .toggle-knob {
            transform: translateX(28px);
            background: 
                repeating-linear-gradient(
                    90deg,
                    #f8f9fa 0px,
                    #ffffff 0.5px,
                    #f8f9fa 1px
                ),
                linear-gradient(180deg, #e8ecf4 0%, #d8dce4 100%);
        }

        .toggle-label {
            margin: 0;
            cursor: pointer;
            font-size: 1.0rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 1px;
            font-variant: small-caps;
        }

        .toggle-status {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6a6e76;
            text-align: center;
        }

        .toggle-switch input:checked ~ .toggle-status {
            color: #a855f7;
        }

        /* Old checkbox styling - keep for other sections */
        .checkbox-group input[type="checkbox"]:not(.toggle-switch input) {
            width: 20px;
            height: 20px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            border: 2px solid rgba(168, 85, 247, 0.4);
            border-radius: 4px;
            background: rgba(26, 31, 58, 0.6);
            transition: all 0.2s ease;
            position: relative;
        }

        .checkbox-group input[type="checkbox"]:not(.toggle-switch input):checked {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            border-color: #a855f7;
        }

        .checkbox-group input[type="checkbox"]:not(.toggle-switch input):checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-size: 1.0rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 1px;
            font-variant: small-caps;
        }

        /* Inline radio/checkbox labels inside form groups */
        .inline-label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
            font-variant: small-caps;
        }

        /* Modern radio button styling */
        input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(168, 85, 247, 0.4);
            border-radius: 50%;
            background: rgba(26, 31, 58, 0.6);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        /* SLIDER CONTROLS - Replacing radio buttons for Low/Med/High */
        .slider-control-group {
            margin-top: 0.5rem;
        }

        /* Form group with slider - label on left, slider on right */
        .form-group.slider-layout {
            display: flex;
            align-items: flex-start;
            gap: 2rem;
        }

        .form-group.slider-layout > label {
            min-width: 180px;
            margin-bottom: 0;
            padding-top: 0.5rem;
        }

        .form-group.slider-layout .slider-control-group {
            flex: 1;
            margin-top: 0;
        }

        .slider-value-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding: 0 10px;
        }

        .slider-value-label {
            font-size: 0.8rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            font-variant: small-caps;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .slider-value-label.active {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 8px rgba(168, 85, 247, 0.6);
            filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.4));
        }

        .slider-etched-line {
            position: relative;
            height: 8px;
            /* Recessed metallic channel */
            background:
                repeating-linear-gradient(
                    90deg,
                    #a0a4ac 0px,
                    #b0b4bc 0.5px,
                    #a0a4ac 1px
                ),
                linear-gradient(180deg, #909498 0%, #b8bcc4 50%, #909498 100%);
            border-radius: 4px;
            border-top: 1px solid rgba(0, 0, 0, 0.35);
            border-bottom: 1px solid rgba(255, 255, 255, 0.45);
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 -1px 2px rgba(255, 255, 255, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.3);
            margin: 0 10px;
        }

        /* Notch marks at the three positions */
        .slider-etched-line::before {
            content: '';
            position: absolute;
            top: -3px;
            bottom: -3px;
            left: 50%;
            width: 2px;
            transform: translateX(-50%);
            background: linear-gradient(180deg, rgba(0,0,0,0.25) 0%, rgba(255,255,255,0.2) 100%);
            border-radius: 1px;
        }

        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: transparent;
            outline: none;
            cursor: pointer;
            position: relative;
            top: -8px;
            margin: 0;
            padding: 0;
        }

        /* Track — invisible, the etched-line is the visual track */
        .range-slider::-webkit-slider-runnable-track {
            height: 8px;
            background: transparent;
            border-radius: 4px;
        }

        .range-slider::-moz-range-track {
            height: 8px;
            background: transparent;
            border: none;
            border-radius: 4px;
        }

        /* Thumb — machined metal knob */
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            margin-top: -10px;
            /* Brushed steel knob */
            background:
                repeating-linear-gradient(
                    180deg,
                    #d8dce4 0px,
                    #e8ecf4 1px,
                    #d8dce4 2px
                ),
                linear-gradient(90deg, #b8bcc4 0%, #d8dce4 30%, #e8ecf4 50%, #d8dce4 70%, #b8bcc4 100%);
            border: 1.5px solid #8a8e96;
            box-shadow:
                0 3px 8px rgba(0, 0, 0, 0.35),
                0 1px 3px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.7),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.35),
                inset -1px 0 0 rgba(0, 0, 0, 0.15);
            transition: box-shadow 0.15s ease;
        }

        .range-slider::-moz-range-thumb {
            width: 22px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            background:
                repeating-linear-gradient(
                    180deg,
                    #d8dce4 0px,
                    #e8ecf4 1px,
                    #d8dce4 2px
                ),
                linear-gradient(90deg, #b8bcc4 0%, #d8dce4 30%, #e8ecf4 50%, #d8dce4 70%, #b8bcc4 100%);
            border: 1.5px solid #8a8e96;
            box-shadow:
                0 3px 8px rgba(0, 0, 0, 0.35),
                0 1px 3px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.7),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.35),
                inset -1px 0 0 rgba(0, 0, 0, 0.15);
            transition: box-shadow 0.15s ease;
        }

        /* Hover — lift effect */
        .range-slider::-webkit-slider-thumb:hover {
            box-shadow:
                0 5px 12px rgba(0, 0, 0, 0.4),
                0 2px 5px rgba(0, 0, 0, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.4),
                inset -1px 0 0 rgba(0, 0, 0, 0.15),
                0 0 8px rgba(168, 85, 247, 0.15);
        }

        .range-slider::-moz-range-thumb:hover {
            box-shadow:
                0 5px 12px rgba(0, 0, 0, 0.4),
                0 2px 5px rgba(0, 0, 0, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.4),
                inset -1px 0 0 rgba(0, 0, 0, 0.15),
                0 0 8px rgba(168, 85, 247, 0.15);
        }

        /* Active — pressed down */
        .range-slider::-webkit-slider-thumb:active {
            box-shadow:
                0 1px 4px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(0, 0, 0, 0.15),
                inset 0 -1px 0 rgba(255, 255, 255, 0.4),
                0 0 12px rgba(168, 85, 247, 0.2);
        }

        .range-slider::-moz-range-thumb:active {
            box-shadow:
                0 1px 4px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(0, 0, 0, 0.15),
                inset 0 -1px 0 rgba(255, 255, 255, 0.4),
                0 0 12px rgba(168, 85, 247, 0.2);
        }

        /* Purple position indicator — sits inside the track */
        .slider-container {
            position: relative;
        }

        .slider-container::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: radial-gradient(circle at 40% 40%, #c084fc 0%, #9333ea 60%, #7928c9 100%);
            pointer-events: none;
            box-shadow:
                0 0 4px rgba(168, 85, 247, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            transition: left 0.1s ease;
        }

        /* ============================================
           COMBINATION LOCK DRUM PICKER
           ============================================ */

        /* Outer frame — the lock housing bolted to the case */
        .combo-lock-frame {
            position: relative;
            width: 80%;
            max-width: 440px;
            margin: 0 auto;
            padding: 14px 18px;
            background:
                /* Brushed steel horizontal grain */
                repeating-linear-gradient(
                    0deg,
                    #b0b4bc 0px,
                    #bfc3cb 1px,
                    #cdd1d9 2px,
                    #bfc3cb 3px,
                    #b0b4bc 4px
                ),
                linear-gradient(90deg, #a8acb4 0%, #c0c4cc 50%, #a8acb4 100%);
            border-radius: 10px;
            border: 2px solid #8a8e96;
            box-shadow:
                /* Raised off the surface */
                0 6px 20px rgba(0, 0, 0, 0.5),
                0 2px 8px rgba(0, 0, 0, 0.3),
                /* Beveled top edge */
                inset 0 2px 0 rgba(255, 255, 255, 0.55),
                /* Beveled bottom shadow */
                inset 0 -2px 0 rgba(0, 0, 0, 0.25),
                /* Side bevels */
                inset 2px 0 0 rgba(255, 255, 255, 0.25),
                inset -2px 0 0 rgba(0, 0, 0, 0.15);
        }

        /* Mounting bolts */
        .combo-bolt {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
        }
        .combo-bolt-left { left: -4px; }
        .combo-bolt-right { right: -4px; }

        .combo-bolt-head {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background:
                radial-gradient(circle at 35% 35%, #e8ecf4 0%, #c8ccd4 40%, #9a9ea6 100%);
            border: 1.5px solid #7a7e86;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            position: relative;
        }

        /* Phillips-head screw cross */
        .combo-bolt-head::before,
        .combo-bolt-head::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            background: linear-gradient(180deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.15) 100%);
            border-radius: 1px;
        }
        .combo-bolt-head::before {
            width: 7px;
            height: 1.5px;
            transform: translate(-50%, -50%);
        }
        .combo-bolt-head::after {
            width: 1.5px;
            height: 7px;
            transform: translate(-50%, -50%);
        }

        /* The drum window — recessed slot in the housing */
        .combo-lock-frame .apple-picker-container {
            position: relative;
            height: 260px;
            width: 100%;
            max-width: none;
            margin: 0;
            overflow: hidden;
            border-radius: 6px;
            /* Recessed channel in the metal */
            background:
                /* Vertical brushed aluminum on the drum */
                repeating-linear-gradient(
                    90deg,
                    #d0d4dc 0px,
                    #dce0e8 0.5px,
                    #e8ecf4 1px,
                    #dce0e8 1.5px,
                    #d0d4dc 2px
                ),
                linear-gradient(180deg, #c8ccd4 0%, #d8dce4 50%, #c8ccd4 100%);
            border: 2px solid #888c94;
            box-shadow:
                /* Sunk into the frame */
                inset 0 4px 8px rgba(0, 0, 0, 0.35),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2),
                inset 4px 0 8px rgba(0, 0, 0, 0.15),
                inset -4px 0 8px rgba(0, 0, 0, 0.15),
                /* Subtle outer lip highlight */
                0 1px 0 rgba(255, 255, 255, 0.3);
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        .combo-lock-frame .apple-picker-container:active {
            cursor: grabbing;
        }

        /* Grip ridges on drum sides */
        .drum-ridge {
            position: absolute;
            top: 10%;
            bottom: 10%;
            width: 6px;
            z-index: 12;
            pointer-events: none;
        }
        .drum-ridge-left { left: 0; }
        .drum-ridge-right { right: 0; }

        .drum-ridge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                repeating-linear-gradient(
                    180deg,
                    transparent 0px,
                    rgba(0, 0, 0, 0.12) 2px,
                    rgba(255, 255, 255, 0.15) 3px,
                    transparent 4px
                );
        }

        /* Top curvature shadow — drum rolling away from viewer */
        .combo-lock-frame .apple-picker-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 44%;
            background: linear-gradient(
                180deg,
                rgba(140, 144, 152, 0.98) 0%,
                rgba(160, 164, 172, 0.88) 20%,
                rgba(180, 184, 192, 0.55) 50%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 10;
            border-radius: 6px 6px 0 0;
        }

        /* Bottom curvature shadow */
        .combo-lock-frame .apple-picker-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 44%;
            background: linear-gradient(
                0deg,
                rgba(130, 134, 142, 0.98) 0%,
                rgba(150, 154, 162, 0.88) 20%,
                rgba(170, 174, 182, 0.55) 50%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 10;
            border-radius: 0 0 6px 6px;
        }

        /* Selection window — the reading notch */
        .apple-picker-selection-bar {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 44px;
            transform: translateY(-50%);
            pointer-events: none;
            z-index: 11;
            /* Deep notch cut into the housing */
            border-top: 2px solid rgba(0, 0, 0, 0.45);
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
            background:
                linear-gradient(
                    180deg,
                    rgba(255, 255, 255, 0.08) 0%,
                    rgba(168, 85, 247, 0.08) 50%,
                    rgba(0, 0, 0, 0.05) 100%
                );
            box-shadow:
                inset 0 3px 6px rgba(0, 0, 0, 0.2),
                inset 0 -2px 4px rgba(255, 255, 255, 0.1),
                0 0 8px rgba(168, 85, 247, 0.06);
        }

        /* Left & right selection arrows / indicator marks */
        .apple-picker-selection-bar::before,
        .apple-picker-selection-bar::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 0;
            height: 0;
            transform: translateY(-50%);
        }
        .apple-picker-selection-bar::before {
            left: -1px;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 8px solid rgba(100, 100, 110, 0.6);
            filter: drop-shadow(1px 0 1px rgba(255,255,255,0.3));
        }
        .apple-picker-selection-bar::after {
            right: -1px;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 8px solid rgba(100, 100, 110, 0.6);
            filter: drop-shadow(-1px 0 1px rgba(255,255,255,0.3));
        }

        /* Scroll area */
        .apple-picker-scroll {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            touch-action: none;
        }

        /* The moving list */
        .drum-cylinder {
            position: absolute;
            width: 100%;
            left: 0;
            will-change: transform;
            touch-action: none;
        }

        /* Individual drum plate — etched into the cylinder surface */
        .apple-picker-item {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            touch-action: none;
            /* Laser-etched text — matching app style, softer */
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.25),
                0 -1px 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.15));
            font-variant: small-caps;
            letter-spacing: 0.8px;
            cursor: pointer;
            padding: 0 2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: filter 0.12s;
            /* Groove between plates */
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.18);
            position: relative;
        }

        /* Alternating subtle tint for depth */
        .apple-picker-item:nth-child(even) {
            background-image:
                linear-gradient(
                    180deg,
                    rgba(0, 0, 0, 0.015) 0%,
                    rgba(0, 0, 0, 0.03) 50%,
                    rgba(0, 0, 0, 0.015) 100%
                ),
                linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
        }

        /* Selected item — deeper etch, bolder */
        .apple-picker-item.selected {
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: 1.2px;
            background: linear-gradient(135deg, #4a4e56 0%, #2a2e36 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.35),
                0 -1px 1px rgba(0, 0, 0, 0.55),
                1px 0 0 rgba(255, 255, 255, 0.12),
                -1px 0 1px rgba(0, 0, 0, 0.3);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.25));
        }

        .apple-picker-overlay-top,
        .apple-picker-overlay-bottom {
            display: none;
        }

        /* Inline edit input inside drum item */
        .drum-inline-edit {
            width: 85%;
            height: 34px;
            border: none;
            border-bottom: 2px solid rgba(168, 85, 247, 0.6);
            background: rgba(255, 255, 255, 0.15);
            color: #1a1e26;
            font-family: 'Inter', sans-serif;
            font-size: 1.05rem;
            font-weight: 700;
            text-align: center;
            letter-spacing: 0.8px;
            font-variant: small-caps;
            outline: none;
            border-radius: 3px 3px 0 0;
            box-shadow:
                inset 0 1px 3px rgba(0, 0, 0, 0.15),
                0 0 8px rgba(168, 85, 247, 0.15);
        }

        .drum-inline-edit:focus {
            border-bottom-color: rgba(168, 85, 247, 0.9);
            background: rgba(255, 255, 255, 0.25);
            box-shadow:
                inset 0 1px 3px rgba(0, 0, 0, 0.15),
                0 0 12px rgba(168, 85, 247, 0.25);
        }

        .apple-picker-item.editing {
            background: rgba(168, 85, 247, 0.04) !important;
        }

        /* ============================================
           DESCRIPTOR CHIPS — Tap to Select (text only)
           ============================================ */
        .desc-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            flex: 1;
            padding-top: 0.35rem;
        }

        .desc-chip {
            padding: 0.2rem 0.1rem;
            border: none;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            font-variant: small-caps;
            letter-spacing: 0.5px;
            background: none;
            transition: all 0.3s ease;
            /* Unselected — etched metal text */
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            box-shadow: none;
        }

        .desc-chip:hover {
            filter: drop-shadow(0 0 3px rgba(168, 85, 247, 0.3));
        }

        .desc-chip:active {
            transform: none;
        }

        /* Selected — purple glow text */
        .desc-chip.active {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 8px rgba(168, 85, 247, 0.6);
            filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.4));
            box-shadow: none;
            border: none;
        }

        .desc-chip.active:hover {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* ============================================
           KEY WEAKNESSES — Input + Etched Plates
           ============================================ */
        .weakness-input {
            width: 100%;
            padding: 0.5rem 0.6rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            transition: all 0.3s ease;
        }

        .weakness-input:focus {
            outline: none;
            border-color: var(--purple-primary);
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        /* ============================================
           NOTECARD LAYOUT — Read-only + Pen Edit
           ============================================ */
        .notecard-section {
            min-height: 100px;
        }

        .notecard-layout {
            min-height: 80px;
        }

        .notecard-display {
            display: flex;
            flex-direction: column;
            min-height: 80px;
        }

        .notecard-entries {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        /* Read-only etched entry */
        .notecard-entry {
            display: flex;
            align-items: center;
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            font-weight: 600;
            line-height: 1.5;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.25),
                0 -1px 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.15));
            padding: 0.15rem 0;
        }

        .notecard-entry-text::before {
            content: '• ';
            opacity: 0.4;
        }

        .notecard-entry-text {
            flex: 1;
        }

        /* Delete × shown only in edit mode */
        .notecard-entry-delete {
            display: none;
            width: 18px;
            height: 18px;
            border: none;
            background: none;
            cursor: pointer;
            padding: 0;
            align-items: center;
            justify-content: center;
            opacity: 0.4;
            transition: opacity 0.2s;
            flex-shrink: 0;
            margin-left: 0.5rem;
        }

        .notecard-entry-delete:hover {
            opacity: 0.8;
        }

        .notecard-entry-delete svg {
            stroke: #dc2626;
        }

        /* Edit mode — show delete buttons */
        .notecard-entries.editing .notecard-entry-delete {
            display: flex;
        }

        .notecard-entries.editing .notecard-entry {
            /* Subtle background hint when editable */
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* Inline add input (appears in the entries list) */
        .notecard-inline-input {
            width: 100%;
            padding: 0.3rem 0.4rem;
            background: rgba(26, 31, 58, 0.5);
            border: 1px solid rgba(168, 85, 247, 0.35);
            border-radius: 4px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            outline: none;
            margin-top: 0.2rem;
        }

        .notecard-inline-input:focus {
            border-color: var(--purple-primary);
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.1);
        }

        .notecard-empty {
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-style: italic;
            opacity: 0.3;
            color: #8a8e96;
            padding: 0.5rem 0;
        }

        /* Bottom actions row */
        .notecard-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.3rem;
            margin-top: 0.5rem;
        }

        .notecard-edit-btn,
        .notecard-add-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.3rem;
            opacity: 0.35;
            transition: all 0.2s ease;
        }

        .notecard-edit-btn svg,
        .notecard-add-btn svg {
            stroke: #8a8e96;
            filter: drop-shadow(0 1px 0 rgba(255, 255, 255, 0.3));
        }

        .notecard-edit-btn:hover,
        .notecard-add-btn:hover {
            opacity: 0.7;
        }

        .notecard-edit-btn.active {
            opacity: 0.9;
        }

        .notecard-edit-btn.active svg {
            stroke: #a855f7;
            filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.4));
        }

        .notecard-add-btn {
            display: inline-flex;
        }

        input[type="radio"]:checked {
            border-color: #a855f7;
            background: rgba(26, 31, 58, 0.8);
        }

        input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        input[type="radio"]:hover {
            border-color: rgba(168, 85, 247, 0.6);
        }

        /* Radio group container */
        .radio-group-container {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .radio-option-modern {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: rgba(26, 31, 58, 0.3);
            border: 1px solid rgba(168, 85, 247, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-option-modern:hover {
            background: rgba(26, 31, 58, 0.5);
            border-color: rgba(168, 85, 247, 0.3);
        }

        .radio-option-modern input[type="radio"]:checked ~ label,
        .radio-option-modern:has(input[type="radio"]:checked) {
            background: rgba(168, 85, 247, 0.15);
            border-color: rgba(168, 85, 247, 0.4);
        }

        .radio-option-modern label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            font-variant: small-caps;
        }

        /* Section dividers and contrast */
        .form-section-divider {
            margin: 3rem 0 2rem 0;
            padding: 1.5rem;
            background: 
                repeating-linear-gradient(
                    90deg,
                    #a8acb4 0px,
                    #b8bcc4 0.5px,
                    #c8ccd4 1px,
                    #b8bcc4 1.5px,
                    #a8acb4 2px
                ),
                linear-gradient(180deg, #9ea2aa 0%, #b8bcc4 50%, #9ea2aa 100%);
            border-left: 4px solid var(--purple-primary);
            border-radius: 12px;
            position: relative;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        }

        .form-section-divider::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #a855f7 0%, #22d3ee 100%);
            border-radius: 4px 0 0 4px;
            box-shadow: 0 0 16px rgba(168, 85, 247, 0.6);
        }

        .form-section-header {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            color: #1a1f3a;
            margin: 0;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .form-section-header::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, var(--purple-primary) 0%, var(--cyan-accent) 100%);
            border-radius: 2px;
            box-shadow: 0 0 12px var(--purple-primary);
        }

        /* Alternating subsection backgrounds */
        .form-subsection {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: 
                /* Brushed nickel */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border-radius: 10px;
            border: 2px solid #a8acb4;
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.6),
                inset 0 -2px 0 rgba(0, 0, 0, 0.3),
                inset 2px 0 0 rgba(255, 255, 255, 0.3),
                inset -2px 0 0 rgba(0, 0, 0, 0.2);
        }

        .form-subsection:nth-child(even) {
            /* Same style for all cards */
        }

        .form-subsection-header {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border-bottom: 2px solid rgba(168, 85, 247, 0.4);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-variant: small-caps;
        }

        .form-subsection-header::before {
            content: '';
            width: 24px;
            height: 2px;
            background: linear-gradient(90deg, rgba(168, 85, 247, 0.8) 0%, transparent 100%);
        }

        .import-export {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: 
                linear-gradient(135deg, rgba(139, 146, 168, 0.1) 0%, rgba(90, 98, 120, 0.08) 100%),
                repeating-linear-gradient(
                    45deg,
                    rgba(255, 255, 255, 0.02) 0px,
                    transparent 1px,
                    rgba(255, 255, 255, 0.02) 2px,
                    transparent 3px
                ),
                rgba(26, 31, 58, 0.5);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(139, 146, 168, 0.25);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--orange-primary);
            font-family: 'Orbitron', sans-serif;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        .search-box {
            margin-bottom: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(82, 115, 163, 0.4);
            border-radius: 8px;
            color: var(--white);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--blue-accent);
            box-shadow: 0 0 20px rgba(82, 115, 163, 0.3);
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" onclick="hideSplash()">
        <div class="splash-metal-sheet">
            <div class="splash-logo">EdgeWize</div>
            <div class="splash-card-suits">
                <span class="suit spade"></span>
                <span class="suit club"></span>
                <span class="suit heart"></span>
                <span class="suit diamond"></span>
            </div>
            <div class="splash-copyright">© 2025 EdgeWize. All rights reserved.</div>
        </div>
    </div>

    <div class="container" id="main-container" style="display: none;">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <button class="dashboard-btn" onclick="switchTab('archetype-builder')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    <span>Archetype Definitions</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('archetypes')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Archetypes</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('players')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>Players</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('brief')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span>Pre-Game Brief</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('data')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                    </svg>
                    <span>Data</span>
                </button>
            </div>
        </div>

        <!-- Archetype Definition Tab -->
        <div id="archetype-builder" class="tab-content">
            <div class="section">
                <div class="section-title">⚡ Build New Archetype</div>
                <form id="full-archetype-form">
                    <!-- Basic Info -->
                    <div class="form-group">
                        <label>Archetype Name *</label>
                        <input type="text" id="builder-name" placeholder="e.g., Scared Money, Calling Station" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="builder-description" placeholder="Brief description of this player type..."></textarea>
                    </div>

                    <!-- Play Style Attributes -->
                    <div class="form-section-divider">
                        <div class="form-section-header">Play Style Attributes</div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Pre-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>VPIP</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="vpip" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="vpip" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="vpip" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="vpip" name="vpip">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Pre-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="pfr-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="pfr-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="pfr-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="pfr-aggression" name="pfr-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Defense vs 3-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="fold3bet" data-value="0">Rarely</span>
                                    <span class="slider-value-label" data-slider="fold3bet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label active" data-slider="fold3bet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="fold3bet" name="fold3bet">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Cold Call Freq</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="coldcall" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="coldcall" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="coldcall" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="coldcall" name="coldcall">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Post-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Post-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="postflop-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="postflop-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label active" data-slider="postflop-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="postflop-aggression" name="postflop-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Folds to C-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="foldcbet" data-value="0">Never</span>
                                    <span class="slider-value-label" data-slider="foldcbet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label active" data-slider="foldcbet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="foldcbet" name="foldcbet">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Overall Style</h4>
                        
                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-chases-draws" class="toggle-label">Chases draws</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-chases-draws">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-any-two" class="toggle-label">Limps/cold calls with any two cards</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-any-two">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-loves-faces" class="toggle-label">Loves face cards / any ace</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-loves-faces">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-cheap-river" class="toggle-label">Wants to get to river cheap</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-cheap-river">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-limp-jam" class="toggle-label">Limp/jams with AK, AQ, any pair 88+</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-limp-jam">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-no-river" class="toggle-label">Unable/unwilling to play out to river</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-no-river">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Personality Attributes -->
                    <div class="form-section-divider">
                        <div class="form-section-header">Personality Attributes</div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Psychological</h4>
                        
                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-tilt-prone" class="toggle-label">Tilt prone</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-tilt-prone">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-scared-money" class="toggle-label">Scared money</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-scared-money">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-ego-driven" class="toggle-label">Ego-driven</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-ego-driven">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-result-oriented" class="toggle-label">Result-oriented</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-result-oriented">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-reckless" class="toggle-label">Reckless under pressure</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-reckless">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Player Dynamics</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Table Presence</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="table-talk" data-value="0">Quiet</span>
                                    <span class="slider-value-label" data-slider="table-talk" data-value="1">Engaged</span>
                                    <span class="slider-value-label" data-slider="table-talk" data-value="2">Talkative</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="table-talk" name="table-talk">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Focus Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="attention" data-value="0">Low</span>
                                    <span class="slider-value-label active" data-slider="attention" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="attention" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="1" step="1" class="range-slider" id="attention" name="attention">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Game Awareness</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Stack Protection</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="stack-protection" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="stack-protection" data-value="1">Med</span>
                                    <span class="slider-value-label active" data-slider="stack-protection" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="stack-protection" name="stack-protection">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Skill Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="skill-level" data-value="0">Beginner</span>
                                    <span class="slider-value-label" data-slider="skill-level" data-value="1">Intermediate</span>
                                    <span class="slider-value-label" data-slider="skill-level" data-value="2">Advanced</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="skill-level" name="skill-level">
                            </div>
                        </div>
                    </div>

                    <!-- Exploits -->
                    <div class="form-section-divider">
                        <div class="form-section-header">Exploitation Strategy</div>
                    </div>

                    <div class="form-group">
                        <label>Pre-flop Exploits (one per line)</label>
                        <textarea id="builder-exploits-preflop" placeholder="Steal blinds relentlessly - they fold 90%+
3-bet their rare raises for fold equity
Never cold call their raises without premium hands"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Post-flop Exploits (one per line)</label>
                        <textarea id="builder-exploits-postflop" placeholder="C-bet 100% on all boards - they fold without connection
Double barrel if they call flop
Don't bluff river - if they called flop/turn they have something"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Bubble Exploits (one per line)</label>
                        <textarea id="builder-exploits-bubble" placeholder="Apply maximum ICM pressure - they're paralyzed
Shove any two cards in late position vs their blinds
They'll fold medium pairs to avoid elimination"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Warnings / Red Flags (one per line)</label>
                        <textarea id="builder-warnings" placeholder="If they limp then call a raise - trap with premium hand
If they lead out betting - strong hand, not bluffing
If they check-raise - nuts or very strong"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Additional Notes</label>
                        <textarea id="builder-notes" placeholder="Any other observations about this archetype..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">💾 Save Archetype</button>
                    <button type="button" class="btn btn-secondary" onclick="resetBuilderForm()">🔄 Reset Form</button>
                </form>
            </div>
        </div>

        <!-- Archetypes Tab -->
        <div id="archetypes" class="tab-content">
            <div class="section">
                <div class="section-title">Archetypes</div>
                <button class="btn btn-primary" onclick="showArchetypeForm()">+ New Archetype</button>
                <div class="search-box">
                    <input type="text" id="archetype-search" placeholder="Search archetypes..." onkeyup="filterArchetypes()">
                </div>
                <div class="list-container" id="archetype-list"></div>
            </div>

            <div class="section" id="archetype-form-section" style="display: none;">
                <div class="section-title" id="archetype-form-title">New Archetype</div>
                <form id="archetype-form">
                    <div class="form-group">
                        <label>Archetype Name *</label>
                        <input type="text" id="arch-name" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="arch-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label>VPIP</label>
                        <select id="arch-vpip">
                            <option selected>Low (&lt;25%)</option>
                            <option>Med (25-50%)</option>
                            <option>High (&gt;50%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>PFR</label>
                        <select id="arch-pfr">
                            <option selected>Low (&lt;25%)</option>
                            <option>Med (25-50%)</option>
                            <option>High (&gt;50%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Key Exploits (one per line)</label>
                        <textarea id="arch-exploits" placeholder="Steal blinds relentlessly
C-bet 100% of flops
Don't bluff river"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Warnings (one per line)</label>
                        <textarea id="arch-warnings" placeholder="If they check-raise, they have nuts
Sudden aggression = premium hand"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Archetype</button>
                    <button type="button" class="btn btn-secondary" onclick="hideArchetypeForm()">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="deleteArchetype()" id="delete-archetype-btn" style="display: none;">Delete</button>
                </form>
            </div>
        </div>

        <!-- Players Tab -->
        <div id="players" class="tab-content">
            <!-- Combination Lock Player Picker -->
            <div class="combo-lock-frame">
                <div class="apple-picker-container" id="drum-container">
                    <div class="apple-picker-selection-bar"></div>
                    <div class="apple-picker-scroll">
                        <div class="drum-cylinder" id="player-picker">
                            <!-- Players will be populated here -->
                        </div>
                    </div>
                    <!-- Drum side ridges (grip texture) -->
                    <div class="drum-ridge drum-ridge-left"></div>
                    <div class="drum-ridge drum-ridge-right"></div>
                </div>
            </div>

            <div class="section" id="player-form-section" style="display: none; margin-top: 3rem;">
                <div class="section-title" id="player-form-title">New Player</div>
                <form id="player-form">
                    <!-- Hidden field to store player name -->
                    <input type="hidden" id="player-name" required>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Pre-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>VPIP</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-vpip" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-vpip" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-vpip" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-vpip" name="player-vpip">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Pre-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-pfr-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-pfr-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-pfr-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-pfr-aggression" name="player-pfr-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Defense vs 3-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-fold3bet" data-value="0">Rarely</span>
                                    <span class="slider-value-label" data-slider="player-fold3bet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label" data-slider="player-fold3bet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-fold3bet" name="player-fold3bet">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Cold Call Freq</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-coldcall" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-coldcall" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-coldcall" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-coldcall" name="player-coldcall">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Post-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Post-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-postflop-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-postflop-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-postflop-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-postflop-aggression" name="player-postflop-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Folds to C-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-foldcbet" data-value="0">Never</span>
                                    <span class="slider-value-label" data-slider="player-foldcbet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label" data-slider="player-foldcbet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-foldcbet" name="player-foldcbet">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Player Dynamics</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Table Presence</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-table-talk" data-value="0">Quiet</span>
                                    <span class="slider-value-label" data-slider="player-table-talk" data-value="1">Engaged</span>
                                    <span class="slider-value-label" data-slider="player-table-talk" data-value="2">Talkative</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-table-talk" name="player-table-talk">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Focus Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-attention" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-attention" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-attention" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-attention" name="player-attention">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Style</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-style" data-value="0">Weak-Tight</span>
                                    <span class="slider-value-label" data-slider="player-style" data-value="1">Strong-Tight</span>
                                    <span class="slider-value-label" data-slider="player-style" data-value="2">Weak-Loose</span>
                                    <span class="slider-value-label" data-slider="player-style" data-value="3">Strong-Loose</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="3" value="0" step="1" class="range-slider" id="player-style" name="player-style">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Cunning</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-cunning" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-cunning" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-cunning" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-cunning" name="player-cunning">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Thinking</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-thinking" data-value="0">Automaton</span>
                                    <span class="slider-value-label" data-slider="player-thinking" data-value="1">Average</span>
                                    <span class="slider-value-label" data-slider="player-thinking" data-value="2">Thinking</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-thinking" name="player-thinking">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Game Awareness</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Stack Protection</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-stack-protection" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-stack-protection" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-stack-protection" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-stack-protection" name="player-stack-protection">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Skill Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-skill-level" data-value="0">Beginner</span>
                                    <span class="slider-value-label" data-slider="player-skill-level" data-value="1">Intermediate</span>
                                    <span class="slider-value-label" data-slider="player-skill-level" data-value="2">Advanced</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-skill-level" name="player-skill-level">
                            </div>
                        </div>
                    </div>

                    <!-- Key Weaknesses -->
                    <div class="form-subsection notecard-section">
                        <h4 class="form-subsection-header">Key Weaknesses</h4>
                        <div class="notecard-layout">
                            <div class="notecard-display" id="player-weakness-display">
                                <div class="notecard-entries" id="player-weakness-list"></div>
                                <div class="notecard-actions">
                                    <button type="button" class="notecard-add-btn" id="weakness-add-btn" title="Add new">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                    <button type="button" class="notecard-edit-btn" id="weakness-edit-btn" title="Edit">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Observations -->
                    <div class="form-subsection notecard-section">
                        <h4 class="form-subsection-header">Observations</h4>
                        <div class="notecard-layout">
                            <div class="notecard-display" id="player-observation-display">
                                <div class="notecard-entries" id="player-observation-list"></div>
                                <div class="notecard-actions">
                                    <button type="button" class="notecard-add-btn" id="observation-add-btn" title="Add new">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                    <button type="button" class="notecard-edit-btn" id="observation-edit-btn" title="Edit">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="player-observations" />
                    </div>

                    <!-- Player Description -->
                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Player Description</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Gender</label>
                            <div class="desc-selector" data-field="player-gender">
                                <button type="button" class="desc-chip active" data-value="0">Male</button>
                                <button type="button" class="desc-chip" data-value="1">Female</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Age Range</label>
                            <div class="desc-selector" data-field="player-age">
                                <button type="button" class="desc-chip active" data-value="0">Young Stud</button>
                                <button type="button" class="desc-chip" data-value="1">Young</button>
                                <button type="button" class="desc-chip" data-value="2">Middle</button>
                                <button type="button" class="desc-chip" data-value="3">Old</button>
                                <button type="button" class="desc-chip" data-value="4">Ancient</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Ethnicity</label>
                            <div class="desc-selector" data-field="player-ethnicity">
                                <button type="button" class="desc-chip active" data-value="0">White</button>
                                <button type="button" class="desc-chip" data-value="1">Black</button>
                                <button type="button" class="desc-chip" data-value="2">E Asian</button>
                                <button type="button" class="desc-chip" data-value="3">S Asian</button>
                                <button type="button" class="desc-chip" data-value="4">ME</button>
                                <button type="button" class="desc-chip" data-value="5">Hispanic</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Education</label>
                            <div class="desc-selector" data-field="player-education">
                                <button type="button" class="desc-chip active" data-value="0">Some</button>
                                <button type="button" class="desc-chip" data-value="1">College</button>
                                <button type="button" class="desc-chip" data-value="2">Graduate</button>
                                <button type="button" class="desc-chip" data-value="3">Unknown</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Profession</label>
                            <div class="desc-selector" data-field="player-profession">
                                <button type="button" class="desc-chip active" data-value="0">Trades</button>
                                <button type="button" class="desc-chip" data-value="1">Home</button>
                                <button type="button" class="desc-chip" data-value="2">Technical</button>
                                <button type="button" class="desc-chip" data-value="3">Prof. Svcs.</button>
                                <button type="button" class="desc-chip" data-value="4">Poker Player</button>
                                <button type="button" class="desc-chip" data-value="5">Business Owner</button>
                                <button type="button" class="desc-chip" data-value="6">Retired</button>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-evenly; align-items: center; margin-top: 1.5rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                        <button type="button" class="btn-metallic btn-delete" onclick="deletePlayer()" id="delete-player-btn" title="Delete Player" style="display: none;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                        <button type="button" class="btn-metallic btn-new" onclick="showPlayerForm()" title="New Player">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <line x1="20" y1="8" x2="20" y2="14"></line>
                                <line x1="23" y1="11" x2="17" y2="11"></line>
                            </svg>
                        </button>
                        <button type="submit" class="btn-metallic btn-save" title="Save Player">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                        </button>
                        <button type="button" class="btn-metallic btn-exit" onclick="exitApp()" title="Exit to Dashboard">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Brief Tab -->
        <div id="brief" class="tab-content">
            <div class="section">
                <div class="section-title">Pre-Game Brief Generator</div>
                <div class="form-group">
                    <label>Select Players at Your Table</label>
                    <div id="brief-player-selection"></div>
                </div>
                <button class="btn btn-primary" onclick="generateBrief()">Generate Brief</button>
            </div>

            <div class="section" id="brief-output" style="display: none;">
                <div class="section-title">🎯 Your Pre-Game Brief</div>
                <div id="brief-content"></div>
            </div>
        </div>

        <!-- Data Tab -->
        <div id="data" class="tab-content">
            <div class="section">
                <div class="section-title">Import / Export Data</div>
                <div class="form-group">
                    <label>Export Database (JSON)</label>
                    <button class="btn btn-primary" onclick="exportData()">📥 Download JSON</button>
                </div>
                <div class="form-group">
                    <label>Import Database (JSON)</label>
                    <input type="file" id="import-file" accept=".json">
                    <button class="btn btn-secondary" onclick="importData()">📤 Upload JSON</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Current Database (JSON)</div>
                <pre id="json-display" style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; overflow-x: auto; max-height: 500px;"></pre>
            </div>
        </div>

        <!-- Exit Button -->
        <button class="exit-btn" onclick="exitApp()" title="Exit EdgeWize">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        </button>
    </div>

    <script>
        // Database structure
        let database = {
            archetypes: [],
            realPlayers: []
        };

        // Load from localStorage or use default
        function loadDatabase() {
            const saved = localStorage.getItem('pokerDatabase');
            if (saved) {
                database = JSON.parse(saved);
            } else {
                // Initialize with player list - all attributes default to 0
                const playerNames = [
                    "Aditya Pailla", "Allen Chapman", "Arlo Strozewski", "Ash Gandhi", "Becky Anderson",
                    "Bee Yang", "Bob Tumlinson", "Bob Van Sykle", "Brian Granger", "Carson Mair",
                    "Chandra Kontham", "Charles Lewis", "Charles Wiggins", "Chogyal Tenzin", "Cody Torke",
                    "Curtis Koenig", "Curtis Vierstrate", "Dad Daughter", "Dallas Schmidt", "Dan Kennedy",
                    "Daniel Hutchinson", "Darshan Pathak", "Dhruva Kota", "E", "Erik Elkema",
                    "Gene Boyer", "Hank Blissenblak", "Jason Alexander", "Jason Sell", "Jeff Petronak",
                    "Jeremy Calvelry", "Jerric Jiang", "John Reading", "Jon Kim", "Jos Osterbaur Jr.",
                    "Jos Osterbaur Sr.", "Joseph Casey Pothead", "Kanat Ozturk", "Kevin Kelly", "Kou Vang",
                    "Leo Fussy", "Leo Pinomonti", "Libby", "Louie Hillman", "Lucas Martin",
                    "Luke Struck", "Mason Redberg-Berg", "Matt Alexander", "Matt Fox", "Mike Wang",
                    "Mike Wilklow", "Moon", "Nghia Lee", "Paul Cross", "Paul Eiden",
                    "Phil Nesburg", "Rich Alsup", "Rob Wazwaz", "Rodney Colson", "Ross \"RF\"",
                    "Sam B", "Santoshima Narayan", "Sean Hinton", "Shafat Zaman", "Sitaram",
                    "Steve Belland", "Steve Wazwaz", "Steven Shanks", "Tanner Pray", "Thai Van Dinh",
                    "Tim Votva", "Tyreese Robinson", "Umut Ozturk", "Vic Peppe", "Vijay Yadav",
                    "Wes Cannon"
                ];

                // Create player objects with all attributes set to 0
                const players = playerNames.map(name => ({
                    name: name,
                    observations: null,
                    vpip: 0,
                    pfrAggression: 0,
                    fold3bet: 0,
                    coldcall: 0,
                    postflopAggression: 0,
                    foldcbet: 0,
                    tableTalk: 0,
                    attention: 0,
                    style: 0,
                    cunning: 0,
                    thinking: 0,
                    stackProtection: 0,
                    skillLevel: 0
                }));

                // Load default database with players
                database = {
                    archetypes: [{
                        id: 'scared-money',
                        name: 'Scared Money',
                        description: 'Risk-averse player terrified of losing chips',
                        playStyle: {
                            preflop: { vpip: 'Low (<25%)', pfr: 'Low (<25%)' }
                        },
                        exploits: {
                            preflop: ['Steal blinds relentlessly - they fold 90%+', '3-bet their rare raises for fold equity'],
                            warnings: ['If they limp then call a raise - trap with premium hand', 'If they lead out betting - strong hand']
                        }
                    }],
                    realPlayers: players
                };
                
                // Save to localStorage
                saveDatabase();
            }
            updateAllViews();
        }

        function saveDatabase() {
            // Sort players alphabetically by name before saving
            database.realPlayers.sort((a, b) => a.name.localeCompare(b.name));
            localStorage.setItem('pokerDatabase', JSON.stringify(database));
            updateAllViews();
        }

        // Toggle switch status updates
        document.querySelectorAll('.toggle-switch input[type="checkbox"]').forEach(toggle => {
            toggle.addEventListener('change', function() {
                const status = this.closest('.toggle-container').querySelector('.toggle-status');
                if (status) {
                    status.textContent = this.checked ? 'Yes' : 'No';
                }
            });
            
            // Set initial state
            const status = toggle.closest('.toggle-container').querySelector('.toggle-status');
            if (status) {
                status.textContent = toggle.checked ? 'Yes' : 'No';
            }
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            document.getElementById(tabName).classList.add('active');
            
            // Show exit button only on dashboard
            const exitBtn = document.querySelector('.exit-btn');
            if (exitBtn) {
                exitBtn.style.display = (tabName === 'dashboard') ? 'flex' : 'none';
            }
            
            updateAllViews();
        }

        // Update all views
        function updateAllViews() {
            updateDashboard();
            updateArchetypeList();
            updatePlayerList();
            updatePlayerArchetypeDropdown();
            updateBriefPlayerSelection();
            updateJsonDisplay();
        }

        // Dashboard
        function updateDashboard() {
            // Dashboard now shows buttons only, no stats to update
        }

        // Archetypes
        let currentArchetypeId = null;

        function updateArchetypeList() {
            const list = document.getElementById('archetype-list');
            const html = database.archetypes.map(arch => `
                <div class="list-item" onclick="editArchetype('${arch.id}')">
                    <div class="list-item-header">
                        <div class="list-item-title">${arch.name}</div>
                        <div class="list-item-meta">VPIP: ${arch.playStyle.preflop.vpip} | PFR: ${arch.playStyle.preflop.pfr}</div>
                    </div>
                    <div class="list-item-meta">${arch.description || ''}</div>
                </div>
            `).join('');
            list.innerHTML = html || '<p style="opacity: 0.5;">No archetypes yet</p>';
        }

        function filterArchetypes() {
            const search = document.getElementById('archetype-search').value.toLowerCase();
            const items = document.querySelectorAll('#archetype-list .list-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function showArchetypeForm() {
            currentArchetypeId = null;
            document.getElementById('archetype-form-section').style.display = 'block';
            document.getElementById('archetype-form-title').textContent = 'New Archetype';
            document.getElementById('archetype-form').reset();
            document.getElementById('delete-archetype-btn').style.display = 'none';
        }

        function hideArchetypeForm() {
            document.getElementById('archetype-form-section').style.display = 'none';
            currentArchetypeId = null;
        }

        function editArchetype(id) {
            const arch = database.archetypes.find(a => a.id === id);
            if (!arch) return;
            
            currentArchetypeId = id;
            document.getElementById('archetype-form-section').style.display = 'block';
            document.getElementById('archetype-form-title').textContent = 'Edit Archetype';
            document.getElementById('delete-archetype-btn').style.display = 'inline-block';
            
            document.getElementById('arch-name').value = arch.name;
            document.getElementById('arch-description').value = arch.description || '';
            document.getElementById('arch-vpip').value = arch.playStyle.preflop.vpip;
            document.getElementById('arch-pfr').value = arch.playStyle.preflop.pfr;
            document.getElementById('arch-exploits').value = arch.exploits.preflop.join('\n');
            document.getElementById('arch-warnings').value = arch.exploits.warnings.join('\n');
        }

        function deleteArchetype() {
            if (!confirm('Delete this archetype?')) return;
            database.archetypes = database.archetypes.filter(a => a.id !== currentArchetypeId);
            saveDatabase();
            hideArchetypeForm();
        }

        document.getElementById('archetype-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('arch-name').value;
            const id = currentArchetypeId || name.toLowerCase().replace(/\s+/g, '-');
            
            const archetype = {
                id: id,
                name: name,
                description: document.getElementById('arch-description').value,
                playStyle: {
                    preflop: {
                        vpip: document.getElementById('arch-vpip').value,
                        pfr: document.getElementById('arch-pfr').value
                    }
                },
                exploits: {
                    preflop: document.getElementById('arch-exploits').value.split('\n').filter(x => x.trim()),
                    warnings: document.getElementById('arch-warnings').value.split('\n').filter(x => x.trim())
                }
            };
            
            if (currentArchetypeId) {
                const index = database.archetypes.findIndex(a => a.id === currentArchetypeId);
                database.archetypes[index] = archetype;
            } else {
                database.archetypes.push(archetype);
            }
            
            saveDatabase();
            hideArchetypeForm();
        });

        // Full Archetype Builder Form
        document.getElementById('full-archetype-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('builder-name').value;
            const id = name.toLowerCase().replace(/\s+/g, '-');
            
            const archetype = {
                id: id,
                name: name,
                description: document.getElementById('builder-description').value,
                playStyle: {
                    preflop: {
                        openingRange: document.querySelector('input[name="opening-range"]:checked').value,
                        vpip: document.querySelector('input[name="vpip"]:checked').value,
                        pfr: document.querySelector('input[name="pfr"]:checked').value,
                        threeBet: document.querySelector('input[name="3bet"]:checked').value,
                        foldTo3Bet: document.querySelector('input[name="fold3bet"]:checked').value,
                        coldCall: document.querySelector('input[name="coldcall"]:checked').value
                    },
                    postflop: {
                        aggressionFrequency: document.querySelector('input[name="aggression"]:checked').value,
                        foldToCBet: document.querySelector('input[name="foldcbet"]:checked').value,
                        bluffFrequency: document.querySelector('input[name="bluff"]:checked').value
                    },
                    overallStyle: {
                        chasesDraws: document.getElementById('builder-chases-draws').checked,
                        anyTwoCards: document.getElementById('builder-any-two').checked,
                        lovesFaces: document.getElementById('builder-loves-faces').checked,
                        cheapRiver: document.getElementById('builder-cheap-river').checked,
                        limpJam: document.getElementById('builder-limp-jam').checked,
                        noRiver: document.getElementById('builder-no-river').checked
                    }
                },
                personality: {
                    psychological: {
                        tiltProne: document.getElementById('builder-tilt-prone').checked,
                        scaredMoney: document.getElementById('builder-scared-money').checked,
                        egoDriven: document.getElementById('builder-ego-driven').checked,
                        resultOriented: document.getElementById('builder-result-oriented').checked,
                        reckless: document.getElementById('builder-reckless').checked
                    },
                    tableDynamics: {
                        tableTalk: document.querySelector('input[name="table-talk"]:checked').value,
                        attention: document.querySelector('input[name="attention"]:checked').value
                    },
                    stackProtection: {
                        early: document.querySelector('input[name="stack-early"]:checked').value,
                        middle: document.querySelector('input[name="stack-middle"]:checked').value,
                        bubble: document.querySelector('input[name="stack-bubble"]:checked').value,
                        late: document.querySelector('input[name="stack-late"]:checked').value
                    },
                    skillIndicators: {
                        handReading: document.querySelector('input[name="hand-reading"]:checked').value,
                        gtoAwareness: document.querySelector('input[name="gto"]:checked').value,
                        exploitability: document.querySelector('input[name="exploitability"]:checked').value
                    }
                },
                exploits: {
                    preflop: document.getElementById('builder-exploits-preflop').value.split('\n').filter(x => x.trim()),
                    postflop: document.getElementById('builder-exploits-postflop').value.split('\n').filter(x => x.trim()),
                    bubble: document.getElementById('builder-exploits-bubble').value.split('\n').filter(x => x.trim()),
                    warnings: document.getElementById('builder-warnings').value.split('\n').filter(x => x.trim())
                },
                notes: document.getElementById('builder-notes').value || null
            };
            
            database.archetypes.push(archetype);
            saveDatabase();
            
            alert('Archetype saved! View in Archetypes tab.');
            resetBuilderForm();
        });

        function resetBuilderForm() {
            document.getElementById('full-archetype-form').reset();
        }

        // Players
        let currentPlayerName = null;

        // === DRUM PICKER ENGINE ===
        const DRUM = {
            ITEM_H: 44,          // must match CSS .apple-picker-item height
            offset: 0,           // current scroll offset in px
            velocity: 0,
            friction: 0.92,
            isDragging: false,
            dragStarted: false,
            lastY: 0,
            lastTime: 0,
            animFrame: null,
            items: [],
            selectedIndex: 0,
            container: null,
            cylinder: null,
            containerH: 260,
        };

        function updatePlayerList() {
            DRUM.cylinder = document.getElementById('player-picker');
            DRUM.container = document.getElementById('drum-container');
            const sorted = [...database.realPlayers].sort((a, b) => a.name.localeCompare(b.name));
            DRUM.items = sorted;

            // Measure container
            DRUM.containerH = DRUM.container.offsetHeight || 260;

            // Restore last position: saved offset > localStorage player > 0
            if (DRUM._savedOffset !== undefined) {
                DRUM.offset = DRUM._savedOffset;
            } else {
                const lastPlayer = localStorage.getItem('edgewize_lastPlayer');
                if (lastPlayer && DRUM.items.length > 0) {
                    const idx = DRUM.items.findIndex(p => p.name === lastPlayer);
                    if (idx >= 0) {
                        DRUM.offset = -idx * DRUM.ITEM_H;
                    } else {
                        DRUM.offset = 0;
                    }
                } else {
                    DRUM.offset = 0;
                }
            }

            renderDrumItems();
            bindDrumEvents();

            // Auto-load the currently selected player's profile
            if (DRUM.items.length > 0 && !DRUM._addingNew) {
                const n = DRUM.items.length;
                const centerIdx = Math.round(-DRUM.offset / DRUM.ITEM_H);
                const wrappedIdx = wrapIndex(centerIdx, n);
                const player = DRUM.items[wrappedIdx];
                if (player) {
                    editPlayer(player.name);
                }
            }
        }

        // How many items to render above/below center for visibility
        const DRUM_RENDER_BUFFER = 6;

        function wrapIndex(i, len) {
            return ((i % len) + len) % len;
        }

        function renderDrumItems() {
            const n = DRUM.items.length;
            if (n === 0 || DRUM._editing || DRUM._addingNew) {
                return;
            }

            // Which logical index is at center?
            const centerFloat = -DRUM.offset / DRUM.ITEM_H;
            const centerIdx = Math.round(centerFloat);
            DRUM.selectedIndex = wrapIndex(centerIdx, n);

            const centerY = DRUM.containerH / 2 - DRUM.ITEM_H / 2;

            let html = '';
            for (let delta = -DRUM_RENDER_BUFFER; delta <= DRUM_RENDER_BUFFER; delta++) {
                const logicalIdx = centerIdx + delta;
                const wrappedIdx = wrapIndex(logicalIdx, n);
                const player = DRUM.items[wrappedIdx];

                // Y position: how far from center in px
                const itemY = centerY + (logicalIdx * DRUM.ITEM_H + DRUM.offset);
                const isSelected = delta === 0 || (Math.abs(centerFloat - centerIdx) < 0.01 && delta === 0);
                const sel = wrappedIdx === DRUM.selectedIndex ? ' selected' : '';

                html += `<div class="apple-picker-item${sel}" data-name="${player.name}" data-index="${wrappedIdx}" data-logical="${logicalIdx}" style="position:absolute;top:0;left:0;width:100%;transform:translateY(${itemY}px)">${player.name}</div>`;
            }

            DRUM.cylinder.innerHTML = html;
        }

        function getSnappedOffset(logicalIndex) {
            return -logicalIndex * DRUM.ITEM_H;
        }

        // No clamping — infinite scroll
        function clampOffset(off) {
            return off;
        }

        function hardClampOffset(off) {
            return off;
        }

        function positionDrum() {
            // Not used for positioning anymore — renderDrumItems handles it
            // But keep for compat, just re-render
            renderDrumItems();
        }

        function updateDrumSelection() {
            // Handled inside renderDrumItems
        }

        function snapToIndex(logicalIndex) {
            cancelAnimationFrame(DRUM.animFrame);
            const target = getSnappedOffset(logicalIndex);
            animateSnap(target, () => {
                DRUM._savedOffset = DRUM.offset;
                const n = DRUM.items.length;
                const wrappedIdx = wrapIndex(logicalIndex, n);
                const player = DRUM.items[wrappedIdx];
                if (player) editPlayer(player.name);
            });
        }

        // Snap to nearest logical index from current offset
        function snapToNearest() {
            const n = DRUM.items.length;
            if (n === 0) return;
            const logicalIdx = Math.round(-DRUM.offset / DRUM.ITEM_H);
            snapToIndex(logicalIdx);
        }

        function animateSnap(target, callback) {
            const step = () => {
                const diff = target - DRUM.offset;
                if (Math.abs(diff) < 0.5) {
                    DRUM.offset = target;
                    renderDrumItems();
                    if (callback) callback();
                    return;
                }
                DRUM.offset += diff * 0.18;
                renderDrumItems();
                DRUM.animFrame = requestAnimationFrame(step);
            };
            DRUM.animFrame = requestAnimationFrame(step);
        }

        function momentumScroll() {
            if (DRUM.isDragging) return;

            DRUM.velocity *= DRUM.friction;
            DRUM.offset += DRUM.velocity;
            renderDrumItems();

            if (Math.abs(DRUM.velocity) > 0.5) {
                DRUM.animFrame = requestAnimationFrame(momentumScroll);
            } else {
                DRUM.velocity = 0;
                snapToNearest();
            }
        }

        function bindDrumEvents() {
            const container = DRUM.container;

            // Prevent duplicate listeners
            if (DRUM._bound) return;
            DRUM._bound = true;

            function onDown(clientY, isTouch) {
                cancelAnimationFrame(DRUM.animFrame);
                DRUM.isDragging = true;
                DRUM.dragStarted = false;
                DRUM._isTouch = !!isTouch;
                DRUM.velocity = 0;
                DRUM.lastY = clientY;
                DRUM.lastTime = Date.now();
                DRUM._velocityHistory = [];
                container.style.cursor = 'grabbing';
            }

            function onMove(clientY) {
                if (!DRUM.isDragging) return;
                const now = Date.now();
                const dy = clientY - DRUM.lastY;
                const dt = Math.max(1, now - DRUM.lastTime);

                if (Math.abs(dy) > 2) DRUM.dragStarted = true;

                DRUM.offset += dy;

                // Track recent velocities for rolling average
                const v = dy * (16 / dt);
                DRUM._velocityHistory.push({ v: v, t: now });
                // Keep only last 100ms of samples
                DRUM._velocityHistory = DRUM._velocityHistory.filter(s => now - s.t < 100);

                DRUM.lastY = clientY;
                DRUM.lastTime = now;
                renderDrumItems();
            }

            function onUp() {
                if (!DRUM.isDragging) return;
                DRUM.isDragging = false;
                container.style.cursor = 'grab';

                // Use rolling average velocity
                const history = DRUM._velocityHistory || [];
                if (history.length > 0) {
                    let avgV = history.reduce((sum, s) => sum + s.v, 0) / history.length;
                    // Touch needs a boost — mobile touchmove reports smaller deltas
                    if (DRUM._isTouch) avgV *= 1.8;
                    DRUM.velocity = Math.max(-25, Math.min(25, avgV));
                } else {
                    DRUM.velocity = 0;
                }

                if (Math.abs(DRUM.velocity) < 1) {
                    DRUM.velocity = 0;
                    snapToNearest();
                } else {
                    momentumScroll();
                }
            }

            // Mouse
            container.addEventListener('mousedown', (e) => { e.preventDefault(); onDown(e.clientY, false); });
            window.addEventListener('mousemove', (e) => { if (DRUM.isDragging) { e.preventDefault(); onMove(e.clientY); }});
            window.addEventListener('mouseup', onUp);

            // Touch — bind start to container AND inner elements, move/end to window
            function touchStart(e) { e.preventDefault(); onDown(e.touches[0].clientY, true); }
            container.addEventListener('touchstart', touchStart, { passive: false });
            // Also capture touchstart on scroll area and cylinder for touches that start on items
            const scrollArea = container.querySelector('.apple-picker-scroll');
            const cylinder = container.querySelector('.drum-cylinder');
            if (scrollArea) scrollArea.addEventListener('touchstart', touchStart, { passive: false });
            if (cylinder) cylinder.addEventListener('touchstart', touchStart, { passive: false });
            window.addEventListener('touchmove', (e) => { if (DRUM.isDragging) { e.preventDefault(); onMove(e.touches[0].clientY); }}, { passive: false });
            window.addEventListener('touchend', onUp);
            window.addEventListener('touchcancel', onUp);

            // Mouse wheel — step one item at a time
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                cancelAnimationFrame(DRUM.animFrame);
                const dir = e.deltaY > 0 ? 1 : -1;
                const logicalIdx = Math.round(-DRUM.offset / DRUM.ITEM_H) + dir;
                snapToIndex(logicalIdx);
            }, { passive: false });

            // Click / double-tap on item
            let lastTapTime = 0;
            let lastTapName = null;

            container.addEventListener('click', (e) => {
                if (DRUM.dragStarted) return;
                if (DRUM._editing) return;
                if (e.target.classList.contains('drum-inline-edit')) return;
                if (e.target.classList.contains('drum-new-input')) return;

                const item = e.target.closest('.apple-picker-item');
                if (!item) return;
                const logical = parseInt(item.dataset.logical);
                const wrappedIdx = parseInt(item.dataset.index);
                const playerName = item.dataset.name;
                if (isNaN(logical)) return;

                const now = Date.now();
                const isDoubleTap = (now - lastTapTime < 400) && (lastTapName === playerName);

                if (isDoubleTap && wrappedIdx === DRUM.selectedIndex) {
                    lastTapTime = 0;
                    lastTapName = null;
                    // Start edit on whichever DOM element is currently selected
                    const currentSelected = DRUM.cylinder.querySelector('.apple-picker-item.selected');
                    if (currentSelected) {
                        startDrumInlineEdit(currentSelected, wrappedIdx);
                    }
                } else {
                    lastTapTime = now;
                    lastTapName = playerName;
                    snapToIndex(logical);
                }
            });
        }

        // === INLINE NAME EDITING ===
        function startDrumInlineEdit(item, index) {
            // Don't start if already editing
            if (DRUM._editing) return;
            DRUM._editing = true;

            const player = DRUM.items[index];
            if (!player) { DRUM._editing = false; return; }
            const oldName = player.name;

            // Create input that replaces the item text
            const input = document.createElement('input');
            input.type = 'text';
            input.value = oldName;
            input.className = 'drum-inline-edit';
            input.setAttribute('autocomplete', 'off');
            input.setAttribute('autocorrect', 'off');
            input.setAttribute('spellcheck', 'false');

            // Clear item text content and insert input
            item.textContent = '';
            item.appendChild(input);
            item.classList.add('editing');

            // Focus and select all
            input.focus();
            input.select();

            // Prevent drum drag while editing
            input.addEventListener('mousedown', (e) => e.stopPropagation());
            input.addEventListener('touchstart', (e) => e.stopPropagation());

            let committed = false;

            function commitEdit() {
                if (committed) return;
                committed = true;

                const newName = input.value.trim();
                if (!newName || newName === oldName) {
                    cancelEdit();
                    return;
                }

                // Check for duplicate names
                const duplicate = database.realPlayers.find(p => p.name === newName && p.name !== oldName);
                if (duplicate) {
                    committed = false; // allow retry
                    alert('A player with that name already exists.');
                    input.focus();
                    input.select();
                    return;
                }

                // Update in database
                const dbPlayer = database.realPlayers.find(p => p.name === oldName);
                if (dbPlayer) {
                    dbPlayer.name = newName;
                    if (currentPlayerName === oldName) {
                        currentPlayerName = newName;
                        document.getElementById('player-form-title').textContent = newName;
                        document.getElementById('player-name').value = newName;
                    }
                    saveDatabase();
                }

                // Rebuild drum with new sorted order
                DRUM._editing = false;
                // Find the new index position
                const sorted = [...database.realPlayers].sort((a, b) => a.name.localeCompare(b.name));
                const newIdx = sorted.findIndex(p => p.name === newName);
                DRUM._savedOffset = -(newIdx >= 0 ? newIdx : 0) * DRUM.ITEM_H;
                updatePlayerList();
            }

            function cancelEdit() {
                DRUM._editing = false;
                // Re-render to restore
                renderDrumItems();
            }

            // Save on Enter, cancel on Escape
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    commitEdit();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelEdit();
                }
            });

            // Save on blur
            input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (!committed) commitEdit();
                }, 50);
            });
        }

        function initApplePicker() {
            // Now handled by updatePlayerList + bindDrumEvents
        }

        function selectPlayerFromDropdown() {
            // Legacy function - no longer needed but keeping for compatibility
        }

        function filterPlayers() {
            // No longer needed with picker, but keeping for compatibility
        }

        function updatePlayerArchetypeDropdown() {
            // No longer needed since we removed archetype dropdown
        }

        function showPlayerForm() {
            // Hide any open form first
            document.getElementById('player-form-section').style.display = 'none';
            currentPlayerName = null;

            // Scroll to top of Players tab
            const playersTab = document.getElementById('players');
            playersTab.scrollTo({ top: 0, behavior: 'smooth' });

            // Don't start if already adding
            if (DRUM.cylinder.querySelector('.drum-new-input')) return;

            // Clear the drum and show a single input item centered
            cancelAnimationFrame(DRUM.animFrame);
            DRUM._addingNew = true;

            const centerY = DRUM.containerH / 2 - DRUM.ITEM_H / 2;
            DRUM.cylinder.innerHTML = `<div class="apple-picker-item selected editing" style="position:absolute;top:0;left:0;width:100%;transform:translateY(${centerY}px)"><input type="text" class="drum-inline-edit drum-new-input" placeholder="Enter player name..." autocomplete="off" autocorrect="off" spellcheck="false" /></div>`;

            const input = DRUM.cylinder.querySelector('.drum-new-input');
            setTimeout(() => input.focus(), 150);

            // Prevent drum drag while typing
            input.addEventListener('mousedown', (e) => e.stopPropagation());
            input.addEventListener('touchstart', (e) => e.stopPropagation());

            function commitNewPlayer() {
                const name = input.value.trim();
                if (!name) {
                    cancelNewPlayer();
                    return;
                }

                const duplicate = database.realPlayers.find(p => p.name === name);
                if (duplicate) {
                    alert('A player with that name already exists.');
                    input.focus();
                    input.select();
                    return;
                }

                const newPlayer = {
                    name: name,
                    observationsList: [],
                    weaknesses: [],
                    vpip: 0,
                    pfrAggression: 0,
                    fold3bet: 0,
                    coldcall: 0,
                    postflopAggression: 0,
                    foldcbet: 0,
                    tableTalk: 0,
                    attention: 0,
                    style: 0,
                    cunning: 0,
                    thinking: 0,
                    stackProtection: 0,
                    skillLevel: 0,
                    gender: 0,
                    age: 0,
                    ethnicity: 0,
                    education: 0,
                    profession: 0
                };

                database.realPlayers.push(newPlayer);
                saveDatabase();

                DRUM._addingNew = false;

                // Rebuild and find the new player
                const sorted = [...database.realPlayers].sort((a, b) => a.name.localeCompare(b.name));
                const newIndex = sorted.findIndex(p => p.name === name);
                DRUM._savedOffset = -(newIndex >= 0 ? newIndex : 0) * DRUM.ITEM_H;

                updatePlayerList();
                editPlayer(name);
            }

            function cancelNewPlayer() {
                DRUM._addingNew = false;
                // Restore the drum
                renderDrumItems();
            }

            let committed = false;

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    committed = true;
                    commitNewPlayer();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    committed = true;
                    cancelNewPlayer();
                }
            });

            input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (!committed) {
                        const name = input.value.trim();
                        if (name) {
                            committed = true;
                            commitNewPlayer();
                        } else {
                            committed = true;
                            cancelNewPlayer();
                        }
                    }
                }, 100);
            });
        }

        function hidePlayerForm() {
            document.getElementById('player-form-section').style.display = 'none';
            currentPlayerName = null;
        }

        function editPlayer(name) {
            const player = database.realPlayers.find(p => p.name === name);
            if (!player) return;
            
            currentPlayerName = name;
            localStorage.setItem('edgewize_lastPlayer', name);
            document.getElementById('player-form-section').style.display = 'block';
            document.getElementById('player-form-title').textContent = name;
            document.getElementById('delete-player-btn').style.display = 'inline-block';
            
            document.getElementById('player-name').value = player.name;
            
            // Load all slider values
            document.getElementById('player-vpip').value = player.vpip || 0;
            document.getElementById('player-pfr-aggression').value = player.pfrAggression || 0;
            document.getElementById('player-fold3bet').value = player.fold3bet || 0;
            document.getElementById('player-coldcall').value = player.coldcall || 0;
            document.getElementById('player-postflop-aggression').value = player.postflopAggression || 0;
            document.getElementById('player-foldcbet').value = player.foldcbet || 0;
            document.getElementById('player-table-talk').value = player.tableTalk || 0;
            document.getElementById('player-attention').value = player.attention || 0;
            document.getElementById('player-style').value = player.style || 0;
            document.getElementById('player-cunning').value = player.cunning || 0;
            document.getElementById('player-thinking').value = player.thinking || 0;
            document.getElementById('player-stack-protection').value = player.stackProtection || 0;
            document.getElementById('player-skill-level').value = player.skillLevel || 0;
            
            // Load weaknesses
            renderWeaknessPlates(player.weaknesses || []);

            // Load observations — support old string format migration
            let obsList = player.observationsList || [];
            if (obsList.length === 0 && player.observations) {
                obsList = player.observations.split('\n').filter(x => x.trim());
            }
            renderObservationPlates(obsList);

            // Load description chips
            setDescChip('player-gender', player.gender || 0);
            setDescChip('player-age', player.age || 0);
            setDescChip('player-ethnicity', player.ethnicity || 0);
            setDescChip('player-education', player.education || 0);
            setDescChip('player-profession', player.profession || 0);

            // Update slider label highlighting
            updatePlayerSliders();
        }

        // === KEY WEAKNESSES & OBSERVATIONS (Notecard System) ===
        let _weaknessData = [];
        let _observationData = [];
        let _editMode = { weakness: false, observation: false };

        function getWeaknessesFromUI() { return [..._weaknessData]; }
        function getObservationsFromUI() { return [..._observationData]; }

        function renderNotecard(type) {
            const data = type === 'weakness' ? _weaknessData : _observationData;
            const container = document.getElementById(type === 'weakness' ? 'player-weakness-list' : 'player-observation-list');
            const isEditing = _editMode[type];

            if (data.length === 0 && !isEditing) {
                container.innerHTML = '<div class="notecard-empty">None recorded</div>';
            } else {
                container.innerHTML = data.map((item, i) => `
                    <div class="notecard-entry" data-index="${i}">
                        <span class="notecard-entry-text">${item}</span>
                        <button type="button" class="notecard-entry-delete" onclick="removeNotecardItem('${type}', ${i})" title="Remove">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                `).join('');
            }

            container.classList.toggle('editing', isEditing);

            // In edit mode, make entries clickable to edit text
            if (isEditing) {
                container.querySelectorAll('.notecard-entry').forEach(entry => {
                    entry.querySelector('.notecard-entry-text').addEventListener('click', () => {
                        startInlineEdit(type, entry);
                    });
                    entry.querySelector('.notecard-entry-text').style.cursor = 'pointer';
                });
            }
        }

        function startInlineEdit(type, entryEl) {
            const data = type === 'weakness' ? _weaknessData : _observationData;
            const index = parseInt(entryEl.dataset.index);
            const textEl = entryEl.querySelector('.notecard-entry-text');
            const oldText = data[index];

            // Replace text with input
            const input = document.createElement('input');
            input.type = 'text';
            input.value = oldText;
            input.className = 'notecard-inline-input';
            input.setAttribute('autocomplete', 'off');

            textEl.style.display = 'none';
            entryEl.insertBefore(input, textEl);
            input.focus();
            input.select();

            let committed = false;

            function commit() {
                if (committed) return;
                committed = true;
                const val = input.value.trim();
                if (val && val !== oldText) {
                    data[index] = val;
                    if (type === 'weakness') saveWeaknessesToPlayer(data);
                    else saveObservationsToPlayer(data);
                }
                renderNotecard(type);
            }

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); commit(); }
                else if (e.key === 'Escape') { e.preventDefault(); committed = true; renderNotecard(type); }
            });
            input.addEventListener('blur', () => setTimeout(commit, 80));
        }

        function addInlineEntry(type) {
            const container = document.getElementById(type === 'weakness' ? 'player-weakness-list' : 'player-observation-list');
            if (container.querySelector('.notecard-inline-input')) return;

            // Remove "None recorded" if present
            const empty = container.querySelector('.notecard-empty');
            if (empty) empty.remove();

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'notecard-inline-input';
            input.placeholder = type === 'weakness' ? 'Add weakness...' : 'Add observation...';
            input.setAttribute('autocomplete', 'off');
            container.appendChild(input);
            input.focus();

            let committed = false;

            function commit() {
                if (committed) return;
                committed = true;
                const val = input.value.trim();
                if (val) {
                    if (type === 'weakness') { _weaknessData.push(val); saveWeaknessesToPlayer(_weaknessData); }
                    else { _observationData.push(val); saveObservationsToPlayer(_observationData); }
                }
                renderNotecard(type);
            }

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); commit(); }
                else if (e.key === 'Escape') { e.preventDefault(); committed = true; renderNotecard(type); }
            });
            input.addEventListener('blur', () => setTimeout(commit, 80));
        }

        function removeNotecardItem(type, index) {
            if (type === 'weakness') { _weaknessData.splice(index, 1); saveWeaknessesToPlayer(_weaknessData); }
            else { _observationData.splice(index, 1); saveObservationsToPlayer(_observationData); }
            renderNotecard(type);
        }

        function renderWeaknessPlates(weaknesses) {
            _weaknessData = weaknesses || [];
            _editMode.weakness = false;
            document.getElementById('weakness-edit-btn').classList.remove('active');
            renderNotecard('weakness');
        }

        function renderObservationPlates(observations) {
            _observationData = observations || [];
            _editMode.observation = false;
            document.getElementById('observation-edit-btn').classList.remove('active');
            renderNotecard('observation');
        }

        function addWeakness(text) {
            const trimmed = text.trim();
            if (!trimmed) return;
            _weaknessData.push(trimmed);
            renderNotecard('weakness');
            saveWeaknessesToPlayer(_weaknessData);
        }

        function removeWeakness(index) { removeNotecardItem('weakness', index); }

        function addObservation(text) {
            const trimmed = text.trim();
            if (!trimmed) return;
            _observationData.push(trimmed);
            renderNotecard('observation');
            saveObservationsToPlayer(_observationData);
        }

        function removeObservation(index) { removeNotecardItem('observation', index); }

        function saveWeaknessesToPlayer(weaknesses) {
            if (!currentPlayerName) return;
            const player = database.realPlayers.find(p => p.name === currentPlayerName);
            if (player) { player.weaknesses = weaknesses; saveDatabase(); }
        }

        function saveObservationsToPlayer(observations) {
            if (!currentPlayerName) return;
            const player = database.realPlayers.find(p => p.name === currentPlayerName);
            if (player) { player.observationsList = observations; saveDatabase(); }
        }

        // Pen toggles edit mode (show × and make entries clickable to edit)
        function toggleNotecard(type) {
            _editMode[type] = !_editMode[type];
            document.getElementById(type + '-edit-btn').classList.toggle('active', _editMode[type]);
            renderNotecard(type);
        }

        document.getElementById('weakness-edit-btn').addEventListener('click', () => toggleNotecard('weakness'));
        document.getElementById('observation-edit-btn').addEventListener('click', () => toggleNotecard('observation'));
        document.getElementById('weakness-add-btn').addEventListener('click', () => addInlineEntry('weakness'));
        document.getElementById('observation-add-btn').addEventListener('click', () => addInlineEntry('observation'));

        // === DESCRIPTOR CHIPS ===
        // Wire up all chip selectors
        document.querySelectorAll('.desc-selector').forEach(selector => {
            selector.addEventListener('click', (e) => {
                const chip = e.target.closest('.desc-chip');
                if (!chip) return;
                // Deselect siblings
                selector.querySelectorAll('.desc-chip').forEach(c => c.classList.remove('active'));
                // Select this one
                chip.classList.add('active');
            });
        });

        function setDescChip(field, value) {
            const selector = document.querySelector(`.desc-selector[data-field="${field}"]`);
            if (!selector) return;
            selector.querySelectorAll('.desc-chip').forEach(c => {
                c.classList.toggle('active', parseInt(c.dataset.value) === value);
            });
        }

        function getDescChipValue(field) {
            const selector = document.querySelector(`.desc-selector[data-field="${field}"]`);
            if (!selector) return 0;
            const active = selector.querySelector('.desc-chip.active');
            return active ? parseInt(active.dataset.value) : 0;
        }

        function deletePlayer() {
            if (!confirm('Delete this player?')) return;
            database.realPlayers = database.realPlayers.filter(p => p.name !== currentPlayerName);
            currentPlayerName = null;
            saveDatabase();
            // updatePlayerList will auto-load whichever player is now at the drum center
        }

        document.getElementById('player-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('player-name').value;
            
            const player = {
                name: name,
                observationsList: getObservationsFromUI(),
                weaknesses: getWeaknessesFromUI(),
                vpip: parseInt(document.getElementById('player-vpip').value),
                pfrAggression: parseInt(document.getElementById('player-pfr-aggression').value),
                fold3bet: parseInt(document.getElementById('player-fold3bet').value),
                coldcall: parseInt(document.getElementById('player-coldcall').value),
                postflopAggression: parseInt(document.getElementById('player-postflop-aggression').value),
                foldcbet: parseInt(document.getElementById('player-foldcbet').value),
                tableTalk: parseInt(document.getElementById('player-table-talk').value),
                attention: parseInt(document.getElementById('player-attention').value),
                style: parseInt(document.getElementById('player-style').value),
                cunning: parseInt(document.getElementById('player-cunning').value),
                thinking: parseInt(document.getElementById('player-thinking').value),
                stackProtection: parseInt(document.getElementById('player-stack-protection').value),
                skillLevel: parseInt(document.getElementById('player-skill-level').value),
                gender: getDescChipValue('player-gender'),
                age: getDescChipValue('player-age'),
                ethnicity: getDescChipValue('player-ethnicity'),
                education: getDescChipValue('player-education'),
                profession: getDescChipValue('player-profession')
            };
            
            if (currentPlayerName) {
                const index = database.realPlayers.findIndex(p => p.name === currentPlayerName);
                database.realPlayers[index] = player;
            } else {
                database.realPlayers.push(player);
            }
            
            saveDatabase();
            // Stay on the saved player's profile — update drum to reflect any changes
            DRUM._savedOffset = DRUM.offset;
        });

        // Brief
        function updateBriefPlayerSelection() {
            const container = document.getElementById('brief-player-selection');
            const html = database.realPlayers.map(player => `
                <div class="checkbox-group">
                    <input type="checkbox" id="brief-${player.name}" value="${player.name}">
                    <label for="brief-${player.name}">${player.name}</label>
                </div>
            `).join('');
            container.innerHTML = html || '<p style="opacity: 0.5;">No players in database</p>';
        }

        function generateBrief() {
            const selected = Array.from(document.querySelectorAll('#brief-player-selection input:checked'))
                .map(cb => cb.value);
            
            if (selected.length === 0) {
                alert('Select at least one player');
                return;
            }
            
            const briefHtml = selected.map(playerName => {
                const player = database.realPlayers.find(p => p.name === playerName);
                const arch = database.archetypes.find(a => a.id === player.archetypeId);
                
                if (!arch) return '';
                
                return `
                    <div class="brief-player">
                        <div class="brief-player-name">${player.name}</div>
                        <div style="opacity: 0.7; margin-bottom: 1rem;">${arch.name} • ${player.venue || 'No venue'}</div>
                        
                        <div class="brief-section">
                            <div class="brief-section-title">Key Exploits</div>
                            <ul class="brief-list">
                                ${arch.exploits.preflop.slice(0, 3).map(e => `<li>${e}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="brief-section">
                            <div class="brief-section-title">Watch Out For</div>
                            <ul class="brief-list warnings">
                                ${arch.exploits.warnings.slice(0, 2).map(w => `<li>${w}</li>`).join('')}
                            </ul>
                        </div>
                        
                        ${player.notes ? `<div class="brief-section"><div class="brief-section-title">Notes</div><p style="opacity: 0.8;">${player.notes}</p></div>` : ''}
                    </div>
                `;
            }).join('');
            
            document.getElementById('brief-content').innerHTML = briefHtml;
            document.getElementById('brief-output').style.display = 'block';
        }

        // Data
        function updateJsonDisplay() {
            document.getElementById('json-display').textContent = JSON.stringify(database, null, 2);
        }

        function exportData() {
            const dataStr = JSON.stringify(database, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'poker-database.json';
            link.click();
        }

        function importData() {
            const file = document.getElementById('import-file').files[0];
            if (!file) {
                alert('Select a file first');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    database = JSON.parse(e.target.result);
                    saveDatabase();
                    alert('Database imported successfully!');
                } catch (err) {
                    alert('Error importing file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // Splash screen functionality
        function hideSplash() {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
        }

        function exitApp() {
            // Switch to dashboard tab before exiting
            switchTab('dashboard');
            // Then show splash screen
            document.getElementById('main-container').style.display = 'none';
            document.getElementById('splash-screen').style.display = 'flex';
        }

        function hideSplash() {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
            // Make sure dashboard is active when entering from splash
            switchTab('dashboard');
        }

        // Initialize
        loadDatabase();

        // Slider label highlighting
        function initSlider(sliderId) {
            const slider = document.getElementById(sliderId);
            if (!slider) return;
            
            const labels = document.querySelectorAll(`[data-slider="${sliderId}"]`);
            
            slider.addEventListener('input', function() {
                labels.forEach(label => {
                    if (parseInt(label.dataset.value) === parseInt(this.value)) {
                        label.classList.add('active');
                    } else {
                        label.classList.remove('active');
                    }
                });
                // Update inlay position when slider changes
                updateSliderInlay(this);
            });
            
            // Initial inlay position
            setTimeout(() => updateSliderInlay(slider), 10);
        }

        // Position purple inlay triangle on slider thumb
        function updateSliderInlay(slider) {
            const container = slider.closest('.slider-container');
            if (!container) return;
            
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const value = parseFloat(slider.value);
            
            // Calculate percentage (0.0 to 1.0)
            const percentage = (value - min) / (max - min);
            
            // Calculate thumb center position
            const sliderRect = slider.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // Sliders typically reserve space on each side for the thumb
            const thumbWidth = 18; // 9px on each side of triangle
            const availableWidth = sliderRect.width - thumbWidth;
            const thumbCenterX = (thumbWidth / 2) + (percentage * availableWidth);
            
            // Convert to position relative to container
            const containerOffsetX = sliderRect.left - containerRect.left;
            const inlayLeft = containerOffsetX + thumbCenterX;
            
            // Position the ::after pseudo-element via CSS variable
            container.style.setProperty('--inlay-left', `${inlayLeft}px`);
        }

        // Update CSS to use the variable
        const inlayStyle = document.createElement('style');
        inlayStyle.textContent = `
            .slider-container::after {
                left: var(--inlay-left, 50%) !important;
            }
        `;
        document.head.appendChild(inlayStyle);

        // Initialize all sliders
        ['vpip', 'pfr-aggression', 'fold3bet', 'coldcall',
         'postflop-aggression', 'foldcbet',
         'table-talk', 'attention',
         'stack-protection', 'skill-level'].forEach(initSlider);

        // Initialize player sliders
        ['player-vpip', 'player-pfr-aggression', 'player-fold3bet', 'player-coldcall',
         'player-postflop-aggression', 'player-foldcbet',
         'player-table-talk', 'player-attention',
         'player-style', 'player-cunning', 'player-thinking',
         'player-stack-protection', 'player-skill-level'].forEach(initSlider);

        // Update inlay positions on window resize
        window.addEventListener('resize', () => {
            document.querySelectorAll('.range-slider').forEach(slider => {
                updateSliderInlay(slider);
            });
        });

        // Function to update all player slider labels
        function updatePlayerSliders() {
            ['player-vpip', 'player-pfr-aggression', 'player-fold3bet', 'player-coldcall',
             'player-postflop-aggression', 'player-foldcbet',
             'player-table-talk', 'player-attention',
             'player-style', 'player-cunning', 'player-thinking',
             'player-stack-protection', 'player-skill-level'].forEach(sliderId => {
                const slider = document.getElementById(sliderId);
                if (!slider) return;
                const labels = document.querySelectorAll(`[data-slider="${sliderId}"]`);
                labels.forEach(label => {
                    if (parseInt(label.dataset.value) === parseInt(slider.value)) {
                        label.classList.add('active');
                    } else {
                        label.classList.remove('active');
                    }
                });
                // Update inlay position
                updateSliderInlay(slider);
            });
        }
    </script>
</body>
</html>